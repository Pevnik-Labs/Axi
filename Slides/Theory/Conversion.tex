\documentclass{beamer}
\usepackage[utf8]{inputenc}
\usepackage{babel}
\usepackage{xcolor}
\usepackage{Commands}

\usetheme{Darmstadt}

\title{T-Axi (declarative)}
\author
{
  Wojciech Ko≈Çowski\\
  \and
  Mateusz Pyzik\\
}
\date{}

\begin{document}

\frame{\titlepage}

\section{Conversion}

\NewDocumentCommand{\typeconv}{O{\Gamma} m m}{#1 \vdash #2 \equiv #3\ \texttt{type}}
\NewDocumentCommand{\propconv}{O{\Gamma} m m}{#1 \vdash #2 \equiv #3\ \texttt{prop}}
\NewDocumentCommand{\termconv}{O{\Gamma} m m m}{#1 \vdash #2 \equiv #3 : #4}

\begin{frame}{Type conversion -- sanity checks}

We'll set up the type conversion judgement so that if $\typeconv{A}{B}$ then $\type{A}$ and $\type{B}$.

\end{frame}

\begin{frame}{Type conversion}

\begin{center}
  $\infrule{}{\typeconv{\Unit}{\Unit}}$ \quad
  $\infrule{}{\typeconv{\Empty}{\Empty}}$

  \vspace{2em}

  $\infrule{\typeconv{A_1}{A_2} \quad \typeconv{B_1}{B_2}}{\typeconv{\Fun[r]{A_1}{B_1}}{\Fun[r]{A_2}{B_2}}}$

  \vspace{2em}

  $\infrule{\typeconv{A_1}{A_2}}{\typeconv{\Box[r]{A_1}}{\Box[r]{A_2}}}$

  \vspace{2em}

  $\infrule{\typeconv{A_1}{A_2} \quad \typeconv{B_1}{B_2}}{\typeconv{\Prod{A_1}{B_1}}{\Prod{A_2}{B_2}}}$

  \vspace{2em}

  $\infrule{\typeconv{A_1}{A_2} \quad \typeconv{B_1}{B_2}}{\typeconv{\Sum{A_1}{B_1}}{\Sum{A_2}{B_2}}}$
\end{center}

\end{frame}

\begin{frame}{Type conversion -- properties}

The rules above are the complete definition of type conversion. For now the context $\Gamma$ is not used, but soon it will. We don't need to take any closures -- type conversion already is an equivalence relation.

\begin{itemize}
  \item $\typeconv{A}{A}$
  \item If $\typeconv{A}{B}$ then $\typeconv{B}{A}$
  \item If $\typeconv{A}{B}$ and $\typeconv{B}{C}$ then $\typeconv{A}{C}$
\end{itemize}

\end{frame}

\begin{frame}{Proposition conversion -- sanity checks}

We'll set up the proposition conversion judgement so that if $\propconv{P}{Q}$ then $\prop{P}$ and $\prop{Q}$.

\end{frame}

\begin{frame}{Proposition conversion}

\begin{center}
  $\infrule{}{\propconv{\True}{\True}}$ \quad
  $\infrule{}{\propconv{\False}{\False}}$

  \vspace{2em}

  $\infrule{\propconv{P_1}{P_2} \quad \propconv{Q_1}{Q_2}}{\propconv{\Impl{P_1}{Q_1}}{\Impl{P_2}{Q_2}}}$

  \vspace{2em}

  $\infrule{\propconv{P_1}{P_2} \quad \propconv{Q_1}{Q_2}}{\propconv{\And{P_1}{Q_1}}{\And{P_2}{Q_2}}}$

  \vspace{2em}

  $\infrule{\propconv{P_1}{P_2} \quad \propconv{Q_1}{Q_2}}{\propconv{\Or{P_1}{Q_1}}{\Or{P_2}{Q_2}}}$
\end{center}

\end{frame}

\begin{frame}{Proposition conversion}

\begin{center}
  $\infrule{\typeconv{A_1}{A_2} \quad \propconv[\extend{\Gamma}{x}{A_1}]{P_1}{P_2}}{\propconv{\All{x}[A_1]{P_1}}{\All{x}[A_2]{P_2}}}$

  \vspace{2em}

  $\infrule{\typeconv{A_1}{A_2} \quad \propconv[\extend{\Gamma}{x}{A_1}]{P_1}{P_2}}{\propconv{\Ex{x}[A_1]{P_1}}{\Ex{x}[A_2]{P_2}}}$

  \vspace{2em}

  $\infrule{\typeconv{A_1}{A_2} \quad \termconv{e_1}{e_2}{A_1} \quad \termconv{e_1'}{e_2'}{A_1}}{\propconv{\Eq[A_1]{e_1}{e_1'}}{\Eq[A_2]{e_2}{e_2'}}}$
\end{center}

\end{frame}

\begin{frame}{Term conversion -- sanity checks}

We'll set up the term conversion judgement so that if $\termconv{a_1}{a_2}{A}$ then $\typing{\Gamma}{a_1}{A}$ and $\typing{\Gamma}{a_2}{A}$.

\end{frame}

\begin{frame}{Term conversion -- Empty}

\begin{center}
  $\infrule{\typing{\Gamma}{e_1}{\Empty} \quad \typing{\Gamma}{e_2}{\Empty}}{\termconv[\Gamma]{e_1}{e_2}{\Empty}}$

  \vspace{2em}

  $\infrule{\type[\cartesianize{\Gamma}]{A} \quad \termconv{e_1}{e_2}{\Empty}}{\termconv{\emptyelim{e_1}}{\emptyelim{e_2}}{A}}$
\end{center}

\end{frame}

\begin{frame}{Term conversion -- Unit}

\begin{center}
  $\infrule{\typing{\Gamma}{a}{A}}{\termconv{\unitelim{\unit}{a}}{a}{A}}$

  \vspace{2em}

  $\infrule{\ctx{\Gamma} \quad \subctx{\Gamma}{\scalectx{\Zero}{\Gamma}}}{\termconv[\Gamma]{\unit}{\unit}{\Unit}}$

  \vspace{2em}

  $\infrule{\typing{\Gamma}{u_1}{\Unit} \quad \typing{\Gamma}{u_2}{\Unit}}{\termconv[\Gamma]{u_1}{u_2}{\Unit}}$

  \vspace{2em}

  $\infrule{\decomposectx{\Gamma}{\Gamma_1}{\Gamma_2} \quad \termconv[\Gamma_1]{u_1}{u_2}{\Unit} \quad \termconv[\Gamma_2]{a_1}{a_2}{A}}{\termconv{\unitelim{u_1}{a_1}}{\unitelim{u_2}{a_2}}{A}}$
\end{center}

\end{frame}

\begin{frame}{Term conversion -- functions}

\begin{center}
  $\infrule{\decomposectx{\Gamma}{\Gamma_1}[r]{\Gamma_2} \quad \typing{\extend{\Gamma_1}[\totalqty{r}{A}]{x}{A}}{b}{B} \quad \typing{\Gamma_2}{a}{A}}{\termconv{\app{(\fun[r]{x}[A]{b})}{a}}{\subst{b}{x}{a}}{B}}$

  \vspace{2em}

  $\infrule{\termconv[\extend{\Gamma}[\totalqty{r}{A}]{x}{A}]{\app{f}{x}}{\app{g}{x}}{B}}{\termconv[\Gamma]{f}{g}{\Fun[r]{A}{B}}}$

  \vspace{2em}

  $\infrule{\decomposectx{\Gamma}{\Gamma_1}[r]{\Gamma_2} \quad \termconv[\Gamma_1]{f_1}{f_2}{\Fun[r]{A}{B}} \quad \termconv[\Gamma_2]{a_1}{a_2}{A}}{\termconv{\app{f_1}{a_1}}{\app{f_2}{a_2}}{B}}$
\end{center}

\end{frame}

\begin{frame}{Term conversion -- box}

\begin{center}
  $\infrule{\decomposectx{\Gamma}[r]{\Gamma_1}{\Gamma_2} \quad \typing{\Gamma_1}{a}{A} \quad \typing{\extend{\Gamma_2}[\totalqty{r}{A}]{x}{A}}{b}{B}}{\termconv{\boxelim{x}[A]{\boxintro[r]{a}}{b}}{\subst{b}{x}{a}}{B}}$

  \vspace{2em}

  $\infrule{\subctx{\Gamma}{\scalectx{r}{\Gamma'}} \quad \termconv[\Gamma']{a_1}{a_2}{A}}{\termconv{\boxintro{a_1}}{\boxintro{a_2}}{\Box[r]{A}}}$
  
  \vspace{2em}

  $\infrule{\decomposectx{\Gamma}{\Gamma_1}{\Gamma_2} \quad \termconv[\Gamma_1]{a_1}{a_2}{\Box[r]{A}} \quad \termconv[\extend{\Gamma_2}[\totalqty{r}{A_1}]{x}{A_1}]{b_1}{b_2}{B}}{\termconv{\boxelim{x}[A_1]{a_1}{b_1}}{\boxelim{x}[A_2]{a_2}{b_2}}{B}}$
\end{center}

\end{frame}

\begin{frame}{Term conversion -- product}

\begin{center}

  $\infrule{\decomposectx{\Gamma}{\Gamma_1}{\Gamma_2} \quad \termconv[\Gamma_1]{a_1}{a_2}{A} \quad \termconv[\Gamma_2]{b_1}{b_2}{B}}{\termconv{\pair{a_1}{b_1}}{\pair{a_2}{b_2}}{\Prod{A}{B}}}$

  \vspace{2em}

  $\infrule{\decomposectx{\Gamma}{\Gamma_1}{\Gamma_2} \quad \termconv[\Gamma_1]{e_1}{e_2}{\Prod{A}{B}} \quad \termconv[\extend{\extend{\Gamma_2}[\totalqty{\One}{A}]{x}{A}}[\totalqty{\One}{B}]{y}{B}]{c_1}{c_2}{C}}{\termconv{\letpair{x}{y}{e_1}{c_1}}{\letpair{x}{y}{e_2}{c_2}}{C}}$

\end{center}

\end{frame}

\begin{frame}{Term conversion -- sum}

\begin{center}
  $\infrule{\termconv{a_1}{a_2}{A} \quad \type[\cartesianize{\Gamma}]{B}}{\termconv{\inl{a_1}}{\inl{a_2}}{\Sum{A}{B}}}$ \quad
  $\infrule{\type[\cartesianize{\Gamma}]{A} \quad \termconv{b_1}{b_2}{B}}{\termconv{\inr{b_1}}{\inr{b_2}}{\Sum{A}{B}}}$

  \vspace{2em}

  $\infrule{\decomposectx{\Gamma}{\Gamma_1}{\Gamma_2} \quad \termconv[\Gamma_1]{e_1}{e_2}{\Sum{A}{B}} \quad \begin{array}{l} \termconv[\Gamma_2]{f_1}{f_2}{\Fun[\One]{A}{C}} \\ \termconv[\Gamma_2]{g_1}{g_2}{\Fun[\One]{B}{C}} \end{array}}{\termconv{\case{e_1}{f_1}{g_1}}{\case{e_2}{f_2}{g_2}}{C}}$
\end{center}

\end{frame}

\section{Totality}

\NewDocumentCommand{\emptyenv}{}{\emptyset}
\NewDocumentCommand{\extendenv}{m m m m}{#1, #2 : #3 := #4}
\NewDocumentCommand{\extendthm}{m m m m}{#1, #2 : #3 := #4}
\NewDocumentCommand{\extendpartial}{m m m m}{#1, \texttt{partial}\ #2 : #3 := #4}
\NewDocumentCommand{\totality}{m m m}{#1, \texttt{totality}\ #2\ #3}

\NewDocumentCommand{\env}{m}{#1\ \texttt{env}}

\begin{frame}{Environments}

Global environments: \\
$\Sigma ::=$ \\
\qquad $\emptyenv \pipe \extendthm{\Sigma}{h}{P}{p} \pipe \extendenv{\Sigma}{x}{A}{e} \pipe$ \\
\qquad $\extendpartial{\Sigma}{x}{A}{e} \pipe \totality{\Sigma}{x}{p}$

\end{frame}

\begin{frame}{Well-formed environments}

\begin{center}
  $\infrule{}{\env{\emptyenv}}$

  \vspace{2em}

  $\infrule{\env{\Sigma} \quad h \notin \Sigma \quad \proves[\Sigma \pipe \emptyctx]{p}{P}}{\env{\extendthm{\Sigma}{h}{P}{p}}}$

  \vspace{2em}

  $\infrule{\env{\Sigma} \quad x \notin \Sigma \quad \fulltyping{\Sigma \pipe \emptyctx}[\computable]{e}{A}}{\env{\extendenv{\Sigma}{x}{A}{e}}}$

  \vspace{2em}

  $\infrule{\env{\Sigma} \quad x \notin \Sigma \quad \fulltyping{\Sigma \pipe \emptyctx}[\computable]{e}{A} \quad e\ \textbf{fails syntactic check}}{\env{\extendpartial{\Sigma}{x}{A}{e}}}$

  \vspace{2em}

  $\infrule{\env{\Sigma} \quad \Sigma = \extendpartial{\Sigma_1}{x}{A}{e}, \Sigma_2 \quad \proves[\Sigma \pipe \emptyctx]{p}{\Ex{r}[A]{e =?= r}}}{\env{\totality{\Sigma}{x}{p}}}$
\end{center}

\end{frame}

\end{document}