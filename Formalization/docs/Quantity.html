<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link href="coqdoc.css" rel="stylesheet" type="text/css">
<script type="text/javascript" src="jquery-3.5.1.js"></script>
<script type="text/javascript" src="main.js"></script>
<script type="text/javascript" src="MyStyles.js"></script>
<title>Typonomikon</title>
</head>
<h1 class="libtitle">Quantity</h1>

<div class="code">
</div>

<div class="doc">

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Export</span><br/>
&nbsp;&nbsp;<span class="id" title="var">Bool</span><br/>
&nbsp;&nbsp;<span class="id" title="var">Coq.Classes.RelationClasses</span><br/>
&nbsp;&nbsp;<span class="id" title="var">Coq.Classes.DecidableClass</span>.<br/>

<br/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">Quantity</span> : <span class="id" title="keyword">Type</span> :=<br/>
| <span class="id" title="var">Zero</span><br/>
| <span class="id" title="var">One</span><br/>
| <span class="id" title="var">Few</span><br/>
| <span class="id" title="var">Many</span><br/>
| <span class="id" title="var">Any</span>.<br/>

<br/>
</div>

<div class="doc">
  Quantities keep track of resource usage. They are a crude measure,
  best thought of in the following terms:
<ul class="doclist">
<li> <span class="inlinecode"><span class="id" title="var">Zero</span></span> means <code>0</code> uses

</li>
<li> <span class="inlinecode"><span class="id" title="var">One</span></span> means <code>1</code> use

</li>
<li> <span class="inlinecode"><span class="id" title="var">Few</span></span> means <code>0</code> or <code>1</code> use

</li>
<li> <span class="inlinecode"><span class="id" title="var">Many</span></span> means <code>1</code> or more uses

</li>
<li> <span class="inlinecode"><span class="id" title="var">Any</span></span> means <code>0</code> or more uses

</li>
</ul>

<div class="paragraph"> </div>

  In code the quantity names are words, but on paper, the following symbols
  (inspired by regular expression syntax) are used:
<ul class="doclist">
<li> <span class="inlinecode"><span class="id" title="var">Zero</span></span> is <code>0</code>

</li>
<li> <span class="inlinecode"><span class="id" title="var">One</span></span> is <code>1</code>

</li>
<li> <span class="inlinecode"><span class="id" title="var">Few</span></span> is <code>?</code>

</li>
<li> <span class="inlinecode"><span class="id" title="var">Many</span></span> is <code>+</code>

</li>
<li> <span class="inlinecode"><span class="id" title="var">Any</span></span> is <code>*</code>

</li>
</ul>

<div class="paragraph"> </div>

 <span class="inlinecode"><span class="id" title="var">Quantity</span></span> has decidable equality. 
</div>
<div class="code">

<br/>
#[<span class="id" title="tactic">refine</span>, <span class="id" title="var">export</span>] <span class="id" title="keyword">Instance</span> <span class="id" title="var">Decidable_eq_Quantity</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> : <span class="id" title="var">Quantity</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Decidable</span> (<span class="id" title="var">r</span> = <span class="id" title="var">s</span>) :=<br/>
{<br/>
&nbsp;&nbsp;<span class="id" title="var">Decidable_witness</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">r</span>, <span class="id" title="var">s</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Zero</span>, <span class="id" title="var">Zero</span> =&gt; <span class="id" title="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">One</span> , <span class="id" title="var">One</span>  =&gt; <span class="id" title="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Few</span> , <span class="id" title="var">Few</span>  =&gt; <span class="id" title="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Many</span>, <span class="id" title="var">Many</span> =&gt; <span class="id" title="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Any</span> , <span class="id" title="var">Any</span>  =&gt; <span class="id" title="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span>   , <span class="id" title="var">_</span>    =&gt; <span class="id" title="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>;<br/>
}.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">destruct</span> <span class="id" title="var">r</span>, <span class="id" title="var">s</span>; <span class="id" title="var">cbn</span>.<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab1218"></a><h1 class="section">Subusage ordering</h1>


<div class="paragraph"> </div>

  The <span class="inlinecode"><span class="id" title="var">Subusage</span></span> ordering represents the following idea: quantity <code>r</code> is
  a subusage of quantity <code>s</code> when a resource that must be used <code>r</code> times
  can also be used whenever a resource that must be used <code>s</code> times is expected.

<div class="paragraph"> </div>

  For example, when we must use a resource <span class="inlinecode"><span class="id" title="var">Many</span></span> times, i.e. 1 or more, but a
  resource which must be used <span class="inlinecode"><span class="id" title="var">One</span></span> time is expected, then we have enough, so
  <span class="inlinecode"><span class="id" title="var">Many</span></span> is a <span class="inlinecode"><span class="id" title="var">Subusage</span></span> of <span class="inlinecode"><span class="id" title="var">One</span></span>.

<div class="paragraph"> </div>

  A picture is worth a thousand words:

</div>
<div class="code">

<br/>
<span class="comment">(*<br/>
&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\&nbsp;&nbsp;&nbsp;/&nbsp;\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\&nbsp;/&nbsp;&nbsp;&nbsp;\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;?&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\&nbsp;&nbsp;&nbsp;/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\&nbsp;/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br/>
*)</span><br/>

<br/>
</div>

<div class="doc">
  The diagram is read as usual, with smaller elements at the bottom,
  and going upwards we move towards bigger elements. Explicitly:
<ul class="doclist">
<li> <span class="inlinecode"><span class="id" title="var">Any</span></span> is the bottom element of the <span class="inlinecode"><span class="id" title="var">Subusage</span></span> ordering, as it means
    0 or more, placing no constraint on resource usage whatsoever.

</li>
<li> Above <span class="inlinecode"><span class="id" title="var">Any</span></span> we have <span class="inlinecode"><span class="id" title="var">Few</span></span> (meaning 0 or 1) and <span class="inlinecode"><span class="id" title="var">Many</span></span> (meaning 1 or more).
    Clearly when we must use a resource <span class="inlinecode"><span class="id" title="var">Any</span></span> number of times, i.e. 0 or more,
    we have enough to use it 0 or 1 times, as well as enough to use it 1 or more
    times. Therefore <span class="inlinecode"><span class="id" title="var">Any</span></span> is a <span class="inlinecode"><span class="id" title="var">Subusage</span></span> of both <span class="inlinecode"><span class="id" title="var">Few</span></span> and <span class="inlinecode"><span class="id" title="var">Many</span></span>.

</li>
<li> Above <span class="inlinecode"><span class="id" title="var">Few</span></span> we have <span class="inlinecode"><span class="id" title="var">Zero</span></span> and <span class="inlinecode"><span class="id" title="var">One</span></span>. Clearly if we must use a resource <span class="inlinecode"><span class="id" title="var">Few</span></span>
    (meaning 0 or 1) times, then we have enough to use it 0 times or 1 times,
    hence <span class="inlinecode"><span class="id" title="var">Few</span></span> is a <span class="inlinecode"><span class="id" title="var">Subusage</span></span> of <span class="inlinecode"><span class="id" title="var">Zero</span></span> and <span class="inlinecode"><span class="id" title="var">One</span></span>.

</li>
<li> Above <span class="inlinecode"><span class="id" title="var">Many</span></span> we have <span class="inlinecode"><span class="id" title="var">One</span></span>. Clearly, if we must use a resource <span class="inlinecode"><span class="id" title="var">Many</span></span>
    (i.e. 1 or more) times, then we have enough to use it 1 time, thus <span class="inlinecode"><span class="id" title="var">Many</span></span>
    is a <span class="inlinecode"><span class="id" title="var">Subusage</span></span> of <span class="inlinecode"><span class="id" title="var">One</span></span>.

</li>
<li> Not directly depicted is the fact that <span class="inlinecode"><span class="id" title="var">Subusage</span></span> is reflexive, i.e. any
    quantity is a <span class="inlinecode"><span class="id" title="var">Subusage</span></span> of itself, which should be obvious.

</li>
</ul>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">Subusage</span> : <span class="id" title="var">Quantity</span> -&gt; <span class="id" title="var">Quantity</span> -&gt; <span class="id" title="keyword">Prop</span> :=<br/>
| <span class="id" title="var">Subusage_refl</span>     : <span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> : <span class="id" title="var">Quantity</span>, <span class="id" title="var">Subusage</span> <span class="id" title="var">r</span> <span class="id" title="var">r</span><br/>
| <span class="id" title="var">Subusage_Any_l</span>    : <span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> : <span class="id" title="var">Quantity</span>, <span class="id" title="var">Subusage</span> <span class="id" title="var">Any</span> <span class="id" title="var">r</span><br/>
| <span class="id" title="var">Subusage_Many_One</span> : <span class="id" title="var">Subusage</span> <span class="id" title="var">Many</span> <span class="id" title="var">One</span><br/>
| <span class="id" title="var">Subusage_Few_One</span>  : <span class="id" title="var">Subusage</span> <span class="id" title="var">Few</span> <span class="id" title="var">One</span><br/>
| <span class="id" title="var">Subusage_Few_Zero</span> : <span class="id" title="var">Subusage</span> <span class="id" title="var">Few</span> <span class="id" title="var">Zero</span>.<br/>

<br/>
#[<span class="id" title="var">export</span>] <span class="id" title="keyword">Hint</span> <span class="id" title="keyword">Constructors</span> <span class="id" title="var">Subusage</span> : <span class="id" title="var">core</span>.<br/>

<br/>
</div>

<div class="doc">
  It is also worth pointing out the relationship between <span class="inlinecode"><span class="id" title="var">One</span></span> and <span class="inlinecode"><span class="id" title="var">Zero</span></span>.
  Clearly if we must use a resource <span class="inlinecode"><span class="id" title="var">One</span></span> time, then we cannot use it <span class="inlinecode"><span class="id" title="var">Zero</span></span>
  times, so <span class="inlinecode"><span class="id" title="var">One</span></span> is not a <span class="inlinecode"><span class="id" title="var">Subusage</span></span> of <span class="inlinecode"><span class="id" title="var">Zero</span></span>.

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">not_Subusage_One_Zero</span> :<br/>
&nbsp;&nbsp;~ <span class="id" title="var">Subusage</span> <span class="id" title="var">One</span> <span class="id" title="var">Zero</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">inversion</span> 1.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
  Similarly, if we must use a resource <span class="inlinecode"><span class="id" title="var">Zero</span></span> times, then we cannot use it
  <span class="inlinecode"><span class="id" title="var">One</span></span> time, so <span class="inlinecode"><span class="id" title="var">Zero</span></span> is not a <span class="inlinecode"><span class="id" title="var">Subusage</span></span> of <span class="inlinecode"><span class="id" title="var">One</span></span>.

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">not_Subusage_Zero_One</span> :<br/>
&nbsp;&nbsp;~ <span class="id" title="var">Subusage</span> <span class="id" title="var">Zero</span> <span class="id" title="var">One</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">inversion</span> 1.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
  If we must use a resource <span class="inlinecode"><span class="id" title="var">Many</span></span> (i.e. 1 or more) times, we are not allowed
  to use it 0 times, which is required for a resource that is expected to be
  used <span class="inlinecode"><span class="id" title="var">Few</span></span> times. Hence <span class="inlinecode"><span class="id" title="var">Many</span></span> is not a <span class="inlinecode"><span class="id" title="var">Subusage</span></span> of <span class="inlinecode"><span class="id" title="var">Few</span></span>.

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">not_Subusage_Many_Few</span> :<br/>
&nbsp;&nbsp;~ <span class="id" title="var">Subusage</span> <span class="id" title="var">Many</span> <span class="id" title="var">Few</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">inversion</span> 1.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
  Similarly: if we must use a resource <span class="inlinecode"><span class="id" title="var">Few</span></span> (i.e. 0 or 1) times, then we
  cannot use it more than once, which is required of a resource that is
  expected to be used <span class="inlinecode"><span class="id" title="var">Many</span></span> times, so <span class="inlinecode"><span class="id" title="var">Few</span></span> is not a <span class="inlinecode"><span class="id" title="var">Subusage</span></span> of <span class="inlinecode"><span class="id" title="var">Many</span></span>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">not_Subusage_Few_Many</span> :<br/>
&nbsp;&nbsp;~ <span class="id" title="var">Subusage</span> <span class="id" title="var">Few</span> <span class="id" title="var">Many</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">inversion</span> 1.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" title="var">Subusage</span></span> is a decidable partial order. 
</div>
<div class="code">

<br/>
#[<span class="id" title="var">export</span>] <span class="id" title="keyword">Instance</span> <span class="id" title="var">PreOrder_Subusage</span> :<br/>
&nbsp;&nbsp;<span class="id" title="var">PreOrder</span> <span class="id" title="var">Subusage</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">split</span>; <span class="id" title="tactic">red</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">now</span> <span class="id" title="tactic">do</span> 2 <span class="id" title="tactic">inversion</span> 1.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
#[<span class="id" title="var">export</span>] <span class="id" title="keyword">Instance</span> <span class="id" title="var">Antisymmetric_Subusage</span> :<br/>
&nbsp;&nbsp;<span class="id" title="var">Antisymmetric</span> <span class="id" title="var">_</span> <span class="id" title="var">eq</span> <span class="id" title="var">Subusage</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">do</span> 2 <span class="id" title="tactic">inversion</span> 1.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
#[<span class="id" title="tactic">refine</span>, <span class="id" title="var">export</span>] <span class="id" title="keyword">Instance</span> <span class="id" title="var">Decidable_Subusage</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> : <span class="id" title="var">Quantity</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Decidable</span> (<span class="id" title="var">Subusage</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span>) :=<br/>
{<br/>
&nbsp;&nbsp;<span class="id" title="var">Decidable_witness</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">r</span>, <span class="id" title="var">s</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Any</span> , <span class="id" title="var">_</span>    =&gt; <span class="id" title="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Many</span>, <span class="id" title="var">One</span>  =&gt; <span class="id" title="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Few</span> , <span class="id" title="var">One</span>  =&gt; <span class="id" title="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Few</span> , <span class="id" title="var">Zero</span> =&gt; <span class="id" title="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span>   , <span class="id" title="var">_</span>    =&gt; <span class="id" title="var">decide</span> (<span class="id" title="var">r</span> = <span class="id" title="var">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>;<br/>
}.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">destruct</span> <span class="id" title="var">r</span>, <span class="id" title="var">s</span>; <span class="id" title="var">cbn</span>.<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
  We can also define a comparison function that checks the relationship between
  its arguments in the <span class="inlinecode"><span class="id" title="var">Subusage</span></span> ordering: whether the arguments are comparable,
  whether the first argument is smaller or larger than the other, or whether they
  are equal.

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">Subusage_cmp</span> (<span class="id" title="var">r</span> <span class="id" title="var">s</span> : <span class="id" title="var">Quantity</span>) : <span class="id" title="var">option</span> <span class="id" title="var">comparison</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="var">decide</span> (<span class="id" title="var">r</span> = <span class="id" title="var">s</span>) <span class="id" title="keyword">then</span> <span class="id" title="var">Some</span> <span class="id" title="var">Eq</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">else</span> <span class="id" title="keyword">if</span> <span class="id" title="var">decide</span> (<span class="id" title="var">Subusage</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span>) <span class="id" title="keyword">then</span> <span class="id" title="var">Some</span> <span class="id" title="var">Lt</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">else</span> <span class="id" title="keyword">if</span> <span class="id" title="var">decide</span> (<span class="id" title="var">Subusage</span> <span class="id" title="var">s</span> <span class="id" title="var">r</span>) <span class="id" title="keyword">then</span> <span class="id" title="var">Some</span> <span class="id" title="var">Gt</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">else</span> <span class="id" title="var">None</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">Subusage_cmp_spec_Lt</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> : <span class="id" title="var">Quantity</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Subusage_cmp</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> = <span class="id" title="var">Some</span> <span class="id" title="var">Lt</span> &lt;-&gt; <span class="id" title="var">Subusage</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> /\ <span class="id" title="var">r</span> &lt;&gt; <span class="id" title="var">s</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">intros</span> [] []; <span class="id" title="var">cbn</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">Subusage_cmp_spec_Eq</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> : <span class="id" title="var">Quantity</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Subusage_cmp</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> = <span class="id" title="var">Some</span> <span class="id" title="var">Eq</span> &lt;-&gt; <span class="id" title="var">r</span> = <span class="id" title="var">s</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">intros</span> [] []; <span class="id" title="var">cbn</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">Subusage_cmp_spec_Gt</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> : <span class="id" title="var">Quantity</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Subusage_cmp</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> = <span class="id" title="var">Some</span> <span class="id" title="var">Gt</span> &lt;-&gt; <span class="id" title="var">Subusage</span> <span class="id" title="var">s</span> <span class="id" title="var">r</span> /\ <span class="id" title="var">r</span> &lt;&gt; <span class="id" title="var">s</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">intros</span> [] []; <span class="id" title="var">cbn</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">Subusage_cmp_spec_None</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> : <span class="id" title="var">Quantity</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Subusage_cmp</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> = <span class="id" title="var">None</span> &lt;-&gt; ~ <span class="id" title="var">Subusage</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> /\ ~ <span class="id" title="var">Subusage</span> <span class="id" title="var">s</span> <span class="id" title="var">r</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">now</span> <span class="id" title="tactic">destruct</span> <span class="id" title="var">r</span>, <span class="id" title="var">s</span>; <span class="id" title="tactic">inversion</span> 1.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> [<span class="id" title="var">Hrs</span> <span class="id" title="var">Hsr</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">destruct</span> <span class="id" title="var">r</span>, <span class="id" title="var">s</span>; <span class="id" title="var">cbn</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>; <span class="id" title="var">contradict</span> <span class="id" title="var">Hrs</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>; <span class="id" title="var">contradict</span> <span class="id" title="var">Hsr</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab1219"></a><h1 class="section">Semiring structure</h1>


<div class="paragraph"> </div>

  Quantities form an ordered commutative semiring with no zero divisors and
  with the additional property that if the result of addition is <span class="inlinecode"><span class="id" title="var">Zero</span></span>, then
  so are the arguments.

<div class="paragraph"> </div>

  We define quantity addition and multiplication below and spend the rest of
  this section proving that the above sentence is indeed true.

<div class="paragraph"> </div>

<a id="lab1220"></a><h2 class="section">Addition</h2>


<div class="paragraph"> </div>

  Because quantities are a very crude way of counting, addition is very simple.
  Let's assume we have a quantity <code>r</code> (of some resource, perhaps):
<ul class="doclist">
<li> When we add <span class="inlinecode"><span class="id" title="var">Zero</span></span>, then we still have <code>r</code>.

</li>
<li> When <code>r</code> is not <span class="inlinecode"><span class="id" title="var">Zero</span></span> and we add <span class="inlinecode"><span class="id" title="var">One</span></span> or <span class="inlinecode"><span class="id" title="var">Many</span></span>, then we have <span class="inlinecode"><span class="id" title="var">Many</span></span>.
    Yes, quantity arithmetic is this crude!

</li>
<li> In all other cases, the result is <span class="inlinecode"><span class="id" title="var">Any</span></span>.

</li>
</ul>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">add</span> (<span class="id" title="var">r</span> <span class="id" title="var">s</span> : <span class="id" title="var">Quantity</span>) : <span class="id" title="var">Quantity</span> :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="var">r</span>, <span class="id" title="var">s</span> <span class="id" title="keyword">with</span><br/>
| <span class="id" title="var">Zero</span>, <span class="id" title="var">s</span>    =&gt; <span class="id" title="var">s</span><br/>
| <span class="id" title="var">r</span>   , <span class="id" title="var">Zero</span> =&gt; <span class="id" title="var">r</span><br/>
| <span class="id" title="var">One</span> , <span class="id" title="var">_</span>    =&gt; <span class="id" title="var">Many</span><br/>
| <span class="id" title="var">_</span>   , <span class="id" title="var">One</span>  =&gt; <span class="id" title="var">Many</span><br/>
| <span class="id" title="var">Many</span>, <span class="id" title="var">_</span>    =&gt; <span class="id" title="var">Many</span><br/>
| <span class="id" title="var">_</span>   , <span class="id" title="var">Many</span> =&gt; <span class="id" title="var">Many</span><br/>
| <span class="id" title="var">_</span>, <span class="id" title="var">_</span>       =&gt; <span class="id" title="var">Any</span><br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" title="var">Zero</span></span> is the identity element of <span class="inlinecode"><span class="id" title="var">add</span></span>. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">add_Zero_l</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> : <span class="id" title="var">Quantity</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">add</span> <span class="id" title="var">Zero</span> <span class="id" title="var">r</span> = <span class="id" title="var">r</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">easy</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">add_Zero_r</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> : <span class="id" title="var">Quantity</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">add</span> <span class="id" title="var">r</span> <span class="id" title="var">Zero</span> = <span class="id" title="var">r</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">intros</span> []; <span class="id" title="var">cbn</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
  <span class="inlinecode"><span class="id" title="var">Many</span></span> is the absorbing element of <span class="inlinecode"><span class="id" title="var">add</span></span>, i.e. adding <span class="inlinecode"><span class="id" title="var">Many</span></span> to anything
  results in <span class="inlinecode"><span class="id" title="var">Many</span></span>.

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">add_Many_l</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> : <span class="id" title="var">Quantity</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">add</span> <span class="id" title="var">Many</span> <span class="id" title="var">r</span> = <span class="id" title="var">Many</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">intros</span> []; <span class="id" title="var">cbn</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">add_Many_r</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> : <span class="id" title="var">Quantity</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">add</span> <span class="id" title="var">r</span> <span class="id" title="var">Many</span> = <span class="id" title="var">Many</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">intros</span> []; <span class="id" title="var">cbn</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" title="var">add</span></span> is associative and commutative. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">add_comm</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> : <span class="id" title="var">Quantity</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">add</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> = <span class="id" title="var">add</span> <span class="id" title="var">s</span> <span class="id" title="var">r</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">intros</span> [] []; <span class="id" title="var">cbn</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">add_assoc</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> <span class="id" title="var">t</span> : <span class="id" title="var">Quantity</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">add</span> (<span class="id" title="var">add</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span>) <span class="id" title="var">t</span> = <span class="id" title="var">add</span> <span class="id" title="var">r</span> (<span class="id" title="var">add</span> <span class="id" title="var">s</span> <span class="id" title="var">t</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">intros</span> [] [] []; <span class="id" title="var">cbn</span>; <span class="id" title="var">easy</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
  When the result of <span class="inlinecode"><span class="id" title="var">add</span></span> is <span class="inlinecode"><span class="id" title="var">Zero</span></span>, both arguments also are <span class="inlinecode"><span class="id" title="var">Zero</span></span>. This
  means that there are no "negative" quantities, so quantities are, in some
  sense, more like natural numbers than like integers.

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">add_Zero_inv</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> : <span class="id" title="var">Quantity</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">add</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> = <span class="id" title="var">Zero</span> -&gt; <span class="id" title="var">r</span> = <span class="id" title="var">Zero</span> /\ <span class="id" title="var">s</span> = <span class="id" title="var">Zero</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">intros</span> [] []; <span class="id" title="var">cbn</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" title="var">add</span></span> preserves <span class="inlinecode"><span class="id" title="var">Subusage</span></span> in both arguments. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">Subusage_add</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">r1</span> <span class="id" title="var">r2</span> <span class="id" title="var">s1</span> <span class="id" title="var">s2</span> : <span class="id" title="var">Quantity</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Subusage</span> <span class="id" title="var">r1</span> <span class="id" title="var">r2</span> -&gt; <span class="id" title="var">Subusage</span> <span class="id" title="var">s1</span> <span class="id" title="var">s2</span> -&gt; <span class="id" title="var">Subusage</span> (<span class="id" title="var">add</span> <span class="id" title="var">r1</span> <span class="id" title="var">s1</span>) (<span class="id" title="var">add</span> <span class="id" title="var">r2</span> <span class="id" title="var">s2</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">r1</span> <span class="id" title="var">r2</span> <span class="id" title="var">s1</span> <span class="id" title="var">s2</span> <span class="id" title="var">H1</span> <span class="id" title="var">H2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">transitivity</span> (<span class="id" title="var">add</span> <span class="id" title="var">r2</span> <span class="id" title="var">s1</span>).<br/>
&nbsp;&nbsp;- <span class="id" title="var">now</span> <span class="id" title="tactic">destruct</span> <span class="id" title="var">r2</span>, <span class="id" title="var">s1</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">H1</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">now</span> <span class="id" title="tactic">destruct</span> <span class="id" title="var">r2</span>, <span class="id" title="var">s2</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">H2</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="var">cbn</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab1221"></a><h3 class="section">Alternative definition of addition</h3>


<div class="paragraph"> </div>

  When defining addition, besides the <span class="inlinecode"><span class="id" title="var">Zero</span></span> cases, we highlighted the cases
  when the result is <span class="inlinecode"><span class="id" title="var">Many</span></span> and then said that in all other cases the result
  is <span class="inlinecode"><span class="id" title="var">Any</span></span>.

<div class="paragraph"> </div>

  We could have given an alternative definition, which highlights the cases
  when the result is <span class="inlinecode"><span class="id" title="var">Any</span></span>, and then says that in all other cases the result
  is <span class="inlinecode"><span class="id" title="var">Many</span></span>. Both definitions are equivalent. However, we believe the original
  definition is more intuitive.

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">add'</span> (<span class="id" title="var">r</span> <span class="id" title="var">s</span> : <span class="id" title="var">Quantity</span>) : <span class="id" title="var">Quantity</span> :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="var">r</span>, <span class="id" title="var">s</span> <span class="id" title="keyword">with</span><br/>
| <span class="id" title="var">Zero</span>, <span class="id" title="var">_</span>    =&gt; <span class="id" title="var">s</span><br/>
| <span class="id" title="var">_</span>   , <span class="id" title="var">Zero</span> =&gt; <span class="id" title="var">r</span><br/>
| <span class="id" title="var">Few</span> , <span class="id" title="var">Few</span>  =&gt; <span class="id" title="var">Any</span><br/>
| <span class="id" title="var">Few</span> , <span class="id" title="var">Any</span>  =&gt; <span class="id" title="var">Any</span><br/>
| <span class="id" title="var">Any</span> , <span class="id" title="var">Few</span>  =&gt; <span class="id" title="var">Any</span><br/>
| <span class="id" title="var">Any</span> , <span class="id" title="var">Any</span>  =&gt; <span class="id" title="var">Any</span><br/>
| <span class="id" title="var">_</span>   , <span class="id" title="var">_</span>    =&gt; <span class="id" title="var">Many</span><br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">add'_spec</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> : <span class="id" title="var">Quantity</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">add'</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> = <span class="id" title="var">add</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">intros</span> [] [].<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab1222"></a><h2 class="section">Multiplication</h2>


<div class="paragraph"> </div>

  Multiplication of quantities, like addition, is rather unsophisticated:
<ul class="doclist">
<li> Multiplying by <span class="inlinecode"><span class="id" title="var">Zero</span></span> gives <span class="inlinecode"><span class="id" title="var">Zero</span></span>, like for ordinary numbers

</li>
<li> Multiplying by <span class="inlinecode"><span class="id" title="var">One</span></span> doesn't change the result

</li>
<li> <span class="inlinecode"><span class="id" title="var">Few</span></span> times <span class="inlinecode"><span class="id" title="var">Few</span></span> is <span class="inlinecode"><span class="id" title="var">Few</span></span> and <span class="inlinecode"><span class="id" title="var">Many</span></span> times <span class="inlinecode"><span class="id" title="var">Many</span></span> is <span class="inlinecode"><span class="id" title="var">Many</span></span>

</li>
<li> In all other cases, the result is <span class="inlinecode"><span class="id" title="var">Any</span></span>

</li>
</ul>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">mul</span> (<span class="id" title="var">r</span> <span class="id" title="var">s</span> : <span class="id" title="var">Quantity</span>) : <span class="id" title="var">Quantity</span> :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="var">r</span>, <span class="id" title="var">s</span> <span class="id" title="keyword">with</span><br/>
| <span class="id" title="var">Zero</span>, <span class="id" title="var">_</span>    =&gt; <span class="id" title="var">Zero</span><br/>
| <span class="id" title="var">One</span> , <span class="id" title="var">_</span>    =&gt; <span class="id" title="var">s</span><br/>
| <span class="id" title="var">_</span>   , <span class="id" title="var">Zero</span> =&gt; <span class="id" title="var">Zero</span><br/>
| <span class="id" title="var">_</span>   , <span class="id" title="var">One</span>  =&gt; <span class="id" title="var">r</span><br/>
| <span class="id" title="var">Few</span> , <span class="id" title="var">Few</span>  =&gt; <span class="id" title="var">Few</span><br/>
| <span class="id" title="var">Many</span>, <span class="id" title="var">Many</span> =&gt; <span class="id" title="var">Many</span><br/>
| <span class="id" title="var">_</span>   , <span class="id" title="var">_</span>    =&gt; <span class="id" title="var">Any</span><br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" title="var">One</span></span> is the identity element of <span class="inlinecode"><span class="id" title="var">mul</span></span>. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">mul_One_l</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> : <span class="id" title="var">Quantity</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mul</span> <span class="id" title="var">One</span> <span class="id" title="var">r</span> = <span class="id" title="var">r</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">easy</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">mul_One_r</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> : <span class="id" title="var">Quantity</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mul</span> <span class="id" title="var">r</span> <span class="id" title="var">One</span> = <span class="id" title="var">r</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">intros</span> []; <span class="id" title="var">cbn</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" title="var">Zero</span></span> is the absorbing element of <span class="inlinecode"><span class="id" title="var">mul</span></span>. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">mul_Zero_l</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> : <span class="id" title="var">Quantity</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mul</span> <span class="id" title="var">Zero</span> <span class="id" title="var">r</span> = <span class="id" title="var">Zero</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">easy</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">mul_Zero_r</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> : <span class="id" title="var">Quantity</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mul</span> <span class="id" title="var">r</span> <span class="id" title="var">Zero</span> = <span class="id" title="var">Zero</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">intros</span> []; <span class="id" title="var">cbn</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" title="var">mul</span></span> is associative and commutative. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">mul_comm</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> : <span class="id" title="var">Quantity</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mul</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> = <span class="id" title="var">mul</span> <span class="id" title="var">s</span> <span class="id" title="var">r</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">intros</span> [] []; <span class="id" title="var">cbn</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">mul_assoc</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> <span class="id" title="var">t</span> : <span class="id" title="var">Quantity</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mul</span> (<span class="id" title="var">mul</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span>) <span class="id" title="var">t</span> = <span class="id" title="var">mul</span> <span class="id" title="var">r</span> (<span class="id" title="var">mul</span> <span class="id" title="var">s</span> <span class="id" title="var">t</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">intros</span> [] [] []; <span class="id" title="var">cbn</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
  When the result of <span class="inlinecode"><span class="id" title="var">mul</span></span> is <span class="inlinecode"><span class="id" title="var">Zero</span></span>, one of the arguments must also be <span class="inlinecode"><span class="id" title="var">Zero</span></span>.
  In this way quantities are similar to ordinary numbers.

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">mul_Zero_inv</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> : <span class="id" title="var">Quantity</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mul</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> = <span class="id" title="var">Zero</span> -&gt; <span class="id" title="var">r</span> = <span class="id" title="var">Zero</span> \/ <span class="id" title="var">s</span> = <span class="id" title="var">Zero</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">intros</span> [] []; <span class="id" title="var">cbn</span>; <span class="id" title="tactic">inversion</span> 1; <span class="id" title="tactic">intuition</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" title="var">mul</span></span> preserves <span class="inlinecode"><span class="id" title="var">Subusage</span></span> in both arguments. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">Subusage_mul</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">r1</span> <span class="id" title="var">r2</span> <span class="id" title="var">s1</span> <span class="id" title="var">s2</span> : <span class="id" title="var">Quantity</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Subusage</span> <span class="id" title="var">r1</span> <span class="id" title="var">r2</span> -&gt; <span class="id" title="var">Subusage</span> <span class="id" title="var">s1</span> <span class="id" title="var">s2</span> -&gt; <span class="id" title="var">Subusage</span> (<span class="id" title="var">mul</span> <span class="id" title="var">r1</span> <span class="id" title="var">s1</span>) (<span class="id" title="var">mul</span> <span class="id" title="var">r2</span> <span class="id" title="var">s2</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">r1</span> <span class="id" title="var">r2</span> <span class="id" title="var">s1</span> <span class="id" title="var">s2</span> <span class="id" title="var">H1</span> <span class="id" title="var">H2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">transitivity</span> (<span class="id" title="var">mul</span> <span class="id" title="var">r2</span> <span class="id" title="var">s1</span>).<br/>
&nbsp;&nbsp;- <span class="id" title="var">now</span> <span class="id" title="tactic">destruct</span> <span class="id" title="var">r2</span>, <span class="id" title="var">s1</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">H1</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">now</span> <span class="id" title="tactic">destruct</span> <span class="id" title="var">r2</span>, <span class="id" title="var">s2</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">H2</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="var">cbn</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab1223"></a><h2 class="section">Distributivity laws</h2>

<div class="paragraph"> </div>

 <span class="inlinecode"><span class="id" title="var">mul</span></span> distributes over <span class="inlinecode"><span class="id" title="var">add</span></span> on both sides. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">mul_add_l</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> <span class="id" title="var">t</span> : <span class="id" title="var">Quantity</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mul</span> <span class="id" title="var">r</span> (<span class="id" title="var">add</span> <span class="id" title="var">s</span> <span class="id" title="var">t</span>) = <span class="id" title="var">add</span> (<span class="id" title="var">mul</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span>) (<span class="id" title="var">mul</span> <span class="id" title="var">r</span> <span class="id" title="var">t</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">intros</span> [] [] []; <span class="id" title="var">cbn</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">mul_add_r</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> <span class="id" title="var">t</span> : <span class="id" title="var">Quantity</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mul</span> (<span class="id" title="var">add</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span>) <span class="id" title="var">t</span> = <span class="id" title="var">add</span> (<span class="id" title="var">mul</span> <span class="id" title="var">r</span> <span class="id" title="var">t</span>) (<span class="id" title="var">mul</span> <span class="id" title="var">s</span> <span class="id" title="var">t</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">intros</span> [] [] []; <span class="id" title="var">cbn</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab1224"></a><h1 class="section">Structure of the subusage ordering</h1>


<div class="paragraph"> </div>

  In this section we'll study the <span class="inlinecode"><span class="id" title="var">Subusage</span></span> ordering in a bit more depth.
  Our goal will be to define the infimum and supremum operations, find their
  nice intuitive characterizations and prove their specifications.

<div class="paragraph"> </div>

  The key to finding this intuitive characterization will be to change
  perspective. Until now we have though about quantities as a crude kind
  of arithmetic. But we can view them differently: quantities represent
  traits that a resource type may implement, or combinations of such traits,
  or the lack of such traits.
<ul class="doclist">
<li> <span class="inlinecode"><span class="id" title="var">One</span></span> means that a type has no special traits. Such types are called
    linear. More intuitively they can also be called "resource types".

</li>
<li> <span class="inlinecode"><span class="id" title="var">Few</span></span> means that a type has the <code>Drop</code> trait. Elements of droppable
    types may be deleted and not used at all (unlike elements of linear
    types, which must be used exactly once).

</li>
<li> <span class="inlinecode"><span class="id" title="var">Many</span></span> means that a type has the <code>Copy</code> trait. Elements of copiable
    types may be copied and used multiple times (unlike elements of linear
    types, which must be used exactly once).

</li>
<li> <span class="inlinecode"><span class="id" title="var">Any</span></span> means that a type has both the <code>Drop</code> and <code>Copy</code> traits. Such
    types are called cartesian (in math speak). More intuitively they can
    also be called "data types", as this is how data behaves in ordinary
    languages - it can be freely copied and deleted.

</li>
<li> <span class="inlinecode"><span class="id" title="var">Zero</span></span>, however, is not a trait - it simply means that, no matter what trait
    this type has, the resource has been used up and is no longer available. The
    fact that <span class="inlinecode"><span class="id" title="var">Zero</span></span> is not a trait will be the key observation when looking for
    a nice characterization for infima and suprema.

</li>
</ul>

<div class="paragraph"> </div>

  To put it differently: when a type implements the trait <code>r</code>, then the
  elements of this type by default have quantity <code>r</code> instead of <span class="inlinecode"><span class="id" title="var">One</span></span>.

<div class="paragraph"> </div>

<a id="lab1225"></a><h2 class="section">Infimum</h2>


<div class="paragraph"> </div>

  Here's an explicit definition of the infimum. To see what's going on, take
  a look at the diagram of the <span class="inlinecode"><span class="id" title="var">Subusage</span></span> ordering: to find the infimum, we
  start at <code>r</code> and <code>s</code> and then keep going downwards until they meet in
  the same point, which is the infimum.

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">explicit_inf</span> (<span class="id" title="var">r</span> <span class="id" title="var">s</span> : <span class="id" title="var">Quantity</span>) : <span class="id" title="var">Quantity</span> :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="var">r</span>, <span class="id" title="var">s</span> <span class="id" title="keyword">with</span><br/>
| <span class="id" title="var">Any</span> , <span class="id" title="var">_</span>    =&gt; <span class="id" title="var">Any</span><br/>
| <span class="id" title="var">_</span>   , <span class="id" title="var">Any</span>  =&gt; <span class="id" title="var">Any</span><br/>
| <span class="id" title="var">Many</span>, <span class="id" title="var">Few</span>  =&gt; <span class="id" title="var">Any</span><br/>
| <span class="id" title="var">Many</span>, <span class="id" title="var">Zero</span> =&gt; <span class="id" title="var">Any</span><br/>
| <span class="id" title="var">Many</span>, <span class="id" title="var">_</span>    =&gt; <span class="id" title="var">Many</span><br/>
| <span class="id" title="var">Few</span> , <span class="id" title="var">Many</span> =&gt; <span class="id" title="var">Any</span><br/>
| <span class="id" title="var">Few</span> , <span class="id" title="var">_</span>    =&gt; <span class="id" title="var">Few</span><br/>
| <span class="id" title="var">One</span> , <span class="id" title="var">Zero</span> =&gt; <span class="id" title="var">Few</span><br/>
| <span class="id" title="var">One</span> , <span class="id" title="var">_</span>    =&gt; <span class="id" title="var">s</span><br/>
| <span class="id" title="var">Zero</span>, <span class="id" title="var">One</span>  =&gt; <span class="id" title="var">Few</span><br/>
| <span class="id" title="var">Zero</span>, <span class="id" title="var">Many</span> =&gt; <span class="id" title="var">Any</span><br/>
| <span class="id" title="var">Zero</span>, <span class="id" title="var">_</span>    =&gt; <span class="id" title="var">s</span><br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
  The above definition is in some sense simple, as it directly follows the
  diagram, but it's also long. To find a better characterization, we need
  to think in terms of traits. The key is to observe how multiplication
  works on traits: it turns out that if a type has traits <code>r</code> and <code>s</code>,
  then it also has the trait <code>mul r s</code>, i.e. multiplication represents
  combining traits!

<div class="paragraph"> </div>

  As far as <span class="inlinecode"><span class="id" title="var">Zero</span></span> is concerned, recall that there are no zero divisors,
  i.e. when the result of <span class="inlinecode"><span class="id" title="var">mul</span></span> is <span class="inlinecode"><span class="id" title="var">Zero</span></span>, one of its arguments must also
  be <span class="inlinecode"><span class="id" title="var">Zero</span></span>. When we take the contraposition of this, we see that when both
  arguments of <span class="inlinecode"><span class="id" title="var">mul</span></span> are non-zero, i.e. when both are traits, then the result
  is also non-zero, i.e. also a trait.

<div class="paragraph"> </div>

  So multiplication of traits represents a "composite" trait that subsumes
  both its arguments, whereas multiplication by a non-trait results in a
  non-trait.

<div class="paragraph"> </div>

  Armed with this knowledge, we can now give a more intuitive definition of
  the infimum: on traits, infimum is the same as multiplication, but on <span class="inlinecode"><span class="id" title="var">Zero</span></span>
  we still need to compute the result case-by-case.

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">inf</span> (<span class="id" title="var">r</span> <span class="id" title="var">s</span> : <span class="id" title="var">Quantity</span>) : <span class="id" title="var">Quantity</span> :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="var">r</span>, <span class="id" title="var">s</span> <span class="id" title="keyword">with</span><br/>
| <span class="id" title="var">Zero</span>, <span class="id" title="var">One</span>  =&gt; <span class="id" title="var">Few</span><br/>
| <span class="id" title="var">Zero</span>, <span class="id" title="var">Many</span> =&gt; <span class="id" title="var">Any</span><br/>
| <span class="id" title="var">Zero</span>, <span class="id" title="var">_</span>    =&gt; <span class="id" title="var">s</span><br/>
| <span class="id" title="var">One</span> , <span class="id" title="var">Zero</span> =&gt; <span class="id" title="var">Few</span><br/>
| <span class="id" title="var">Many</span>, <span class="id" title="var">Zero</span> =&gt; <span class="id" title="var">Any</span><br/>
| <span class="id" title="var">_</span>   , <span class="id" title="var">Zero</span> =&gt; <span class="id" title="var">r</span><br/>
| <span class="id" title="var">_</span>   , <span class="id" title="var">_</span>    =&gt; <span class="id" title="var">mul</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span><br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
Both definitions are equivalent. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">inf_explicit_inf</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> : <span class="id" title="var">Quantity</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">inf</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> = <span class="id" title="var">explicit_inf</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">intros</span> [] [].<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
  <span class="inlinecode"><span class="id" title="var">inf</span></span> is associative, commutative and idempotent.
  <span class="inlinecode"><span class="id" title="var">Any</span></span> is its absorbing element.

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">inf_Any_l</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> : <span class="id" title="var">Quantity</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">inf</span> <span class="id" title="var">Any</span> <span class="id" title="var">r</span> = <span class="id" title="var">Any</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">intros</span> [].<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">inf_Any_r</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> : <span class="id" title="var">Quantity</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">inf</span> <span class="id" title="var">r</span> <span class="id" title="var">Any</span> = <span class="id" title="var">Any</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">intros</span> []; <span class="id" title="var">cbn</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">inf_idem</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> : <span class="id" title="var">Quantity</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">inf</span> <span class="id" title="var">r</span> <span class="id" title="var">r</span> = <span class="id" title="var">r</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">intros</span> []; <span class="id" title="var">cbn</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">inf_comm</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> : <span class="id" title="var">Quantity</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">inf</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> = <span class="id" title="var">inf</span> <span class="id" title="var">s</span> <span class="id" title="var">r</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">intros</span> [] []; <span class="id" title="var">cbn</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">inf_assoc</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> <span class="id" title="var">t</span> : <span class="id" title="var">Quantity</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">inf</span> (<span class="id" title="var">inf</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span>) <span class="id" title="var">t</span> = <span class="id" title="var">inf</span> <span class="id" title="var">r</span> (<span class="id" title="var">inf</span> <span class="id" title="var">s</span> <span class="id" title="var">t</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">intros</span> [] [] []; <span class="id" title="var">cbn</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" title="var">inf</span></span> truly is the infimum in the <span class="inlinecode"><span class="id" title="var">Subusage</span></span> ordering. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">Subusage_inf_l_l</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> : <span class="id" title="var">Quantity</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Subusage</span> (<span class="id" title="var">inf</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span>) <span class="id" title="var">r</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">intros</span> [] []; <span class="id" title="var">cbn</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">Subusage_inf_l_r</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> : <span class="id" title="var">Quantity</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Subusage</span> (<span class="id" title="var">inf</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span>) <span class="id" title="var">s</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">intros</span> [] []; <span class="id" title="var">cbn</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">Subusage_inf_r</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">q</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> : <span class="id" title="var">Quantity</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Subusage</span> <span class="id" title="var">q</span> <span class="id" title="var">r</span> -&gt; <span class="id" title="var">Subusage</span> <span class="id" title="var">q</span> <span class="id" title="var">s</span> -&gt; <span class="id" title="var">Subusage</span> <span class="id" title="var">q</span> (<span class="id" title="var">inf</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">do</span> 2 <span class="id" title="tactic">inversion</span> 1; <span class="id" title="var">only</span> 1: <span class="id" title="tactic">destruct</span> <span class="id" title="var">s</span>; <span class="id" title="var">cbn</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">inf_spec</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> <span class="id" title="var">rs</span> : <span class="id" title="var">Quantity</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">inf</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> = <span class="id" title="var">rs</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Subusage</span> <span class="id" title="var">rs</span> <span class="id" title="var">r</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Subusage</span> <span class="id" title="var">rs</span> <span class="id" title="var">s</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">q</span> : <span class="id" title="var">Quantity</span>, <span class="id" title="var">Subusage</span> <span class="id" title="var">q</span> <span class="id" title="var">r</span> -&gt; <span class="id" title="var">Subusage</span> <span class="id" title="var">q</span> <span class="id" title="var">s</span> -&gt; <span class="id" title="var">Subusage</span> <span class="id" title="var">q</span> <span class="id" title="var">rs</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> &lt;-.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>; [| <span class="id" title="tactic">split</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">Subusage_inf_l_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">Subusage_inf_l_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">now</span> <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">Subusage_inf_r</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> (<span class="id" title="var">Htr</span> &amp; <span class="id" title="var">Hts</span> &amp; <span class="id" title="var">Huniq</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Antisymmetric_Subusage</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <span class="id" title="var">Huniq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">Subusage_inf_l_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">Subusage_inf_l_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">Subusage_inf_r</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" title="var">inf</span></span> preserves <span class="inlinecode"><span class="id" title="var">Subusage</span></span> in both arguments. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">Subusage_inf_inf</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">r1</span> <span class="id" title="var">r2</span> <span class="id" title="var">s1</span> <span class="id" title="var">s2</span> : <span class="id" title="var">Quantity</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Subusage</span> <span class="id" title="var">r1</span> <span class="id" title="var">r2</span> -&gt; <span class="id" title="var">Subusage</span> <span class="id" title="var">s1</span> <span class="id" title="var">s2</span> -&gt; <span class="id" title="var">Subusage</span> (<span class="id" title="var">inf</span> <span class="id" title="var">r1</span> <span class="id" title="var">s1</span>) (<span class="id" title="var">inf</span> <span class="id" title="var">r2</span> <span class="id" title="var">s2</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">r1</span> <span class="id" title="var">r2</span> <span class="id" title="var">s1</span> <span class="id" title="var">s2</span> <span class="id" title="var">Hr</span> <span class="id" title="var">Hs</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">transitivity</span> (<span class="id" title="var">inf</span> <span class="id" title="var">r2</span> <span class="id" title="var">s1</span>).<br/>
&nbsp;&nbsp;- <span class="id" title="var">now</span> <span class="id" title="tactic">destruct</span> <span class="id" title="var">s1</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">Hr</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">now</span> <span class="id" title="tactic">destruct</span> <span class="id" title="var">r2</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">Hs</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="var">cbn</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
The algebraic and order structures are related in the usual way. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">Subusage_iff_inf_eq</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> : <span class="id" title="var">Quantity</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Subusage</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> &lt;-&gt; <span class="id" title="var">inf</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> = <span class="id" title="var">r</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">intros</span> [] []; <span class="id" title="var">cbn</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab1226"></a><h2 class="section">Complement</h2>


<div class="paragraph"> </div>

  Before we look supremum, let's stop for a moment and define a complement
  operation which will turn out to be useful. Given a trait <code>r</code>, we can
  define its complement as the trait that is needed to turn <code>r</code> into <span class="inlinecode"><span class="id" title="var">Any</span></span>,
  i.e. into a data type. As for <span class="inlinecode"><span class="id" title="var">Zero</span></span>, which is not a trait, it's complement
  will be <span class="inlinecode"><span class="id" title="var">Zero</span></span> - this is the only sensible choice that makes all the later
  theorems true :)

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">complement</span> (<span class="id" title="var">r</span> : <span class="id" title="var">Quantity</span>) : <span class="id" title="var">Quantity</span> :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="var">r</span> <span class="id" title="keyword">with</span><br/>
| <span class="id" title="var">Zero</span> =&gt; <span class="id" title="var">Zero</span><br/>
| <span class="id" title="var">One</span>  =&gt; <span class="id" title="var">Any</span><br/>
| <span class="id" title="var">Few</span>  =&gt; <span class="id" title="var">Many</span><br/>
| <span class="id" title="var">Many</span> =&gt; <span class="id" title="var">Few</span><br/>
| <span class="id" title="var">Any</span>  =&gt; <span class="id" title="var">One</span><br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" title="var">complement</span></span> is an involution. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">complement_complement</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> : <span class="id" title="var">Quantity</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">complement</span> (<span class="id" title="var">complement</span> <span class="id" title="var">r</span>) = <span class="id" title="var">r</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">intros</span> []; <span class="id" title="var">cbn</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" title="var">complement</span></span> flips the <span class="inlinecode"><span class="id" title="var">Subusage</span></span> ordering, but only on traits. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">Subusage_complement</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> : <span class="id" title="var">Quantity</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Subusage</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> -&gt; <span class="id" title="var">s</span> = <span class="id" title="var">Zero</span> \/ <span class="id" title="var">Subusage</span> (<span class="id" title="var">complement</span> <span class="id" title="var">s</span>) (<span class="id" title="var">complement</span> <span class="id" title="var">r</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">intros</span> <span class="id" title="var">r</span> []; <span class="id" title="tactic">inversion</span> 1; <span class="id" title="var">cbn</span>; <span class="id" title="tactic">firstorder</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab1227"></a><h2 class="section">Supremum</h2>


<div class="paragraph"> </div>

  The first thing to notice regarding suprema is that in the <span class="inlinecode"><span class="id" title="var">Subusage</span></span> ordering
  they don't always exist. For example, <span class="inlinecode"><span class="id" title="var">Zero</span></span> and <span class="inlinecode"><span class="id" title="var">One</span></span> don't have a supremum,
  as they're both maximum elements. Because of this, our supremum operation is
  partial - it returns <span class="inlinecode"><span class="id" title="var">None</span></span> when there's no supremum.

<div class="paragraph"> </div>

  The definition below is a direct translation of the <span class="inlinecode"><span class="id" title="var">Subusage</span></span> ordering diagram.

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">explicit_sup</span> (<span class="id" title="var">r</span> <span class="id" title="var">s</span> : <span class="id" title="var">Quantity</span>) : <span class="id" title="var">option</span> <span class="id" title="var">Quantity</span> :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="var">r</span>, <span class="id" title="var">s</span> <span class="id" title="keyword">with</span><br/>
| <span class="id" title="var">Any</span> , <span class="id" title="var">_</span>    =&gt; <span class="id" title="var">Some</span> <span class="id" title="var">s</span><br/>
| <span class="id" title="var">_</span>   , <span class="id" title="var">Any</span>  =&gt; <span class="id" title="var">Some</span> <span class="id" title="var">r</span><br/>
| <span class="id" title="var">Many</span>, <span class="id" title="var">Zero</span> =&gt; <span class="id" title="var">None</span><br/>
| <span class="id" title="var">Many</span>, <span class="id" title="var">Few</span>  =&gt; <span class="id" title="var">Some</span> <span class="id" title="var">One</span><br/>
| <span class="id" title="var">Many</span>, <span class="id" title="var">_</span>    =&gt; <span class="id" title="var">Some</span> <span class="id" title="var">s</span><br/>
| <span class="id" title="var">Few</span> , <span class="id" title="var">Many</span> =&gt; <span class="id" title="var">Some</span> <span class="id" title="var">One</span><br/>
| <span class="id" title="var">Few</span> , <span class="id" title="var">_</span>    =&gt; <span class="id" title="var">Some</span> <span class="id" title="var">s</span><br/>
| <span class="id" title="var">One</span> , <span class="id" title="var">Zero</span> =&gt; <span class="id" title="var">None</span><br/>
| <span class="id" title="var">One</span> , <span class="id" title="var">_</span>    =&gt; <span class="id" title="var">Some</span> <span class="id" title="var">One</span><br/>
| <span class="id" title="var">Zero</span>, <span class="id" title="var">Few</span>  =&gt; <span class="id" title="var">Some</span> <span class="id" title="var">Zero</span><br/>
| <span class="id" title="var">Zero</span>, <span class="id" title="var">Zero</span> =&gt; <span class="id" title="var">Some</span> <span class="id" title="var">Zero</span><br/>
| <span class="id" title="var">Zero</span>, <span class="id" title="var">_</span>    =&gt; <span class="id" title="var">None</span><br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
  To find a simpler definition of the supremum, we need to think in terms of
  traits again. The idea is this: since on traits infimum behaves like multiplication,
  i.e. it finds a trait that has the same capabilities as both of its arguments,
  supremum on traits should behave in the dual way, i.e. it should find a trait
  that has neither of the capabilities that the arguments have.

<div class="paragraph"> </div>

  Here is where the <span class="inlinecode"><span class="id" title="var">complement</span></span> comes handy: <code>complement r</code> represents a
  trait that <code>r</code> is missing to be a data type, but this trait is precisely
  the same thing as the trait "lacks capability r". This is because having
  trait <span class="inlinecode"><span class="id" title="var">Any</span></span>, i.e. having all capabilities, is the same as having capability
  <code>r</code> and also having all the other capabilities except <code>r</code>.

<div class="paragraph"> </div>

  With this key insight, finding the supremum of <code>r</code> and <code>s</code> is easy:
<ul class="doclist">
<li> <code>complement r</code> and <code>complement s</code> represent the missing traits

</li>
<li> <code>mul (complement r) (complement s)</code> represents the trait that has
    both traits that <code>r</code> and <code>s</code> are missing

</li>
<li> <code>complement (mul (complement r) (complement s))</code> represents the trait
    that is missing what both <code>r</code> and <code>s</code> are missing, i.e. the trait
    that has what neither of them have

</li>
</ul>

<div class="paragraph"> </div>

  The remaining thing to do is to patch the definition with cases for <span class="inlinecode"><span class="id" title="var">Zero</span></span>,
  and not even all of them, just the ones when the supremum doesn't exist.

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">sup</span> (<span class="id" title="var">r</span> <span class="id" title="var">s</span> : <span class="id" title="var">Quantity</span>) : <span class="id" title="var">option</span> <span class="id" title="var">Quantity</span> :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="var">r</span>, <span class="id" title="var">s</span> <span class="id" title="keyword">with</span><br/>
| <span class="id" title="var">Zero</span>, <span class="id" title="var">One</span>  =&gt; <span class="id" title="var">None</span><br/>
| <span class="id" title="var">Zero</span>, <span class="id" title="var">Many</span> =&gt; <span class="id" title="var">None</span><br/>
| <span class="id" title="var">One</span> , <span class="id" title="var">Zero</span> =&gt; <span class="id" title="var">None</span><br/>
| <span class="id" title="var">Many</span>, <span class="id" title="var">Zero</span> =&gt; <span class="id" title="var">None</span><br/>
| <span class="id" title="var">_</span>   , <span class="id" title="var">_</span>    =&gt; <span class="id" title="var">Some</span> (<span class="id" title="var">complement</span> (<span class="id" title="var">mul</span> (<span class="id" title="var">complement</span> <span class="id" title="var">r</span>) (<span class="id" title="var">complement</span> <span class="id" title="var">s</span>)))<br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
Both definitions are equivalent. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">sup_explicit_sup</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> : <span class="id" title="var">Quantity</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">sup</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> = <span class="id" title="var">explicit_sup</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">intros</span> [] []; <span class="id" title="var">cbn</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
  When the inputs to <span class="inlinecode"><span class="id" title="var">sup</span></span> are <span class="inlinecode"><span class="id" title="var">complement</span></span>ed, the multiplication is
  "uncomplemented".

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">sup_complement</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> <span class="id" title="var">rs</span> : <span class="id" title="var">Quantity</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">sup</span> (<span class="id" title="var">complement</span> <span class="id" title="var">r</span>) (<span class="id" title="var">complement</span> <span class="id" title="var">s</span>) = <span class="id" title="var">Some</span> <span class="id" title="var">rs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rs</span> = <span class="id" title="var">complement</span> (<span class="id" title="var">mul</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">intros</span> [] [] <span class="id" title="var">rs</span>; <span class="id" title="tactic">inversion</span> 1; <span class="id" title="tactic">subst</span>; <span class="id" title="var">cbn</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
  <span class="inlinecode"><span class="id" title="var">sup</span></span> is commutative, idempotent and its identity element is <span class="inlinecode"><span class="id" title="var">Any</span></span>.
  When all subexpressions are defined, <span class="inlinecode"><span class="id" title="var">sup</span></span> is also associative.

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">sup_Any_l</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> : <span class="id" title="var">Quantity</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">sup</span> <span class="id" title="var">Any</span> <span class="id" title="var">r</span> = <span class="id" title="var">Some</span> <span class="id" title="var">r</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">intros</span> [].<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">sup_Any_r</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> : <span class="id" title="var">Quantity</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">sup</span> <span class="id" title="var">r</span> <span class="id" title="var">Any</span> = <span class="id" title="var">Some</span> <span class="id" title="var">r</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">intros</span> []; <span class="id" title="var">cbn</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">sup_idem</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> : <span class="id" title="var">Quantity</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">sup</span> <span class="id" title="var">r</span> <span class="id" title="var">r</span> = <span class="id" title="var">Some</span> <span class="id" title="var">r</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">intros</span> []; <span class="id" title="var">cbn</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">sup_comm</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> : <span class="id" title="var">Quantity</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">sup</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> = <span class="id" title="var">sup</span> <span class="id" title="var">s</span> <span class="id" title="var">r</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">intros</span> [] []; <span class="id" title="var">cbn</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">sup_assoc</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> <span class="id" title="var">t</span> <span class="id" title="var">rs</span> <span class="id" title="var">st</span> : <span class="id" title="var">Quantity</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">sup</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> = <span class="id" title="var">Some</span> <span class="id" title="var">rs</span> -&gt; <span class="id" title="var">sup</span> <span class="id" title="var">s</span> <span class="id" title="var">t</span> = <span class="id" title="var">Some</span> <span class="id" title="var">st</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">sup</span> <span class="id" title="var">rs</span> <span class="id" title="var">t</span> = <span class="id" title="var">sup</span> <span class="id" title="var">r</span> <span class="id" title="var">st</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">intros</span> [] [] [] <span class="id" title="var">rs</span> <span class="id" title="var">st</span>; <span class="id" title="tactic">do</span> 2 <span class="id" title="tactic">inversion</span> 1; <span class="id" title="var">cbn</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
When <span class="inlinecode"><span class="id" title="var">sup</span></span> is defined, it truly is the supremum in the <span class="inlinecode"><span class="id" title="var">Subusage</span></span> ordering. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">Subusage_sup_r_l</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> <span class="id" title="var">rs</span> : <span class="id" title="var">Quantity</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">sup</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> = <span class="id" title="var">Some</span> <span class="id" title="var">rs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Subusage</span> <span class="id" title="var">r</span> <span class="id" title="var">rs</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">intros</span> [] [] <span class="id" title="var">rs</span>; <span class="id" title="tactic">inversion</span> 1; <span class="id" title="var">cbn</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">Subusage_sup_r_r</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> <span class="id" title="var">rs</span> : <span class="id" title="var">Quantity</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">sup</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> = <span class="id" title="var">Some</span> <span class="id" title="var">rs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Subusage</span> <span class="id" title="var">s</span> <span class="id" title="var">rs</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">intros</span> [] [] <span class="id" title="var">rs</span>; <span class="id" title="tactic">inversion</span> 1; <span class="id" title="var">cbn</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">Subusage_sup_l</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> <span class="id" title="var">t</span> <span class="id" title="var">rs</span> : <span class="id" title="var">Quantity</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">sup</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> = <span class="id" title="var">Some</span> <span class="id" title="var">rs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Subusage</span> <span class="id" title="var">r</span> <span class="id" title="var">t</span> -&gt; <span class="id" title="var">Subusage</span> <span class="id" title="var">s</span> <span class="id" title="var">t</span> -&gt; <span class="id" title="var">Subusage</span> <span class="id" title="var">rs</span> <span class="id" title="var">t</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">intros</span> [] [] <span class="id" title="var">t</span>; <span class="id" title="tactic">do</span> 3 <span class="id" title="tactic">inversion</span> 1; <span class="id" title="tactic">subst</span>; <span class="id" title="var">cbn</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">sup_spec</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> <span class="id" title="var">rs</span> : <span class="id" title="var">Quantity</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">sup</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> = <span class="id" title="var">Some</span> <span class="id" title="var">rs</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Subusage</span> <span class="id" title="var">r</span> <span class="id" title="var">rs</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Subusage</span> <span class="id" title="var">s</span> <span class="id" title="var">rs</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">t</span> : <span class="id" title="var">Quantity</span>, <span class="id" title="var">Subusage</span> <span class="id" title="var">r</span> <span class="id" title="var">t</span> -&gt; <span class="id" title="var">Subusage</span> <span class="id" title="var">s</span> <span class="id" title="var">t</span> -&gt; <span class="id" title="var">Subusage</span> <span class="id" title="var">rs</span> <span class="id" title="var">t</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">Hsup</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>; [| <span class="id" title="tactic">split</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">Subusage_sup_r_l</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Hsup</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">Subusage_sup_r_r</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Hsup</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">now</span> <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">Subusage_sup_l</span> <span class="id" title="keyword">with</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> (<span class="id" title="var">Htr</span> &amp; <span class="id" title="var">Hts</span> &amp; <span class="id" title="var">Huniq</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;The&nbsp;match&nbsp;finds&nbsp;a&nbsp;contradictory&nbsp;instantiation&nbsp;of&nbsp;the&nbsp;hypothesis.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">destruct</span> <span class="id" title="var">r</span>, <span class="id" title="var">s</span>; <span class="id" title="var">cbn</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">Htr</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">congruence</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">Hts</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">congruence</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">H</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">_</span>, <span class="id" title="var">Subusage</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> -&gt; <span class="id" title="var">Subusage</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> -&gt; <span class="id" title="var">Subusage</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> |- <span class="id" title="var">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">H</span> <span class="id" title="var">Any</span>  <span class="id" title="keyword">ltac</span>:(<span class="id" title="var">easy</span>) <span class="id" title="keyword">ltac</span>:(<span class="id" title="var">easy</span>)) +<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">H</span> <span class="id" title="var">Many</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="var">easy</span>) <span class="id" title="keyword">ltac</span>:(<span class="id" title="var">easy</span>)) +<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">H</span> <span class="id" title="var">Few</span>  <span class="id" title="keyword">ltac</span>:(<span class="id" title="var">easy</span>) <span class="id" title="keyword">ltac</span>:(<span class="id" title="var">easy</span>)) +<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">H</span> <span class="id" title="var">One</span>  <span class="id" title="keyword">ltac</span>:(<span class="id" title="var">easy</span>) <span class="id" title="keyword">ltac</span>:(<span class="id" title="var">easy</span>)) +<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">H</span> <span class="id" title="var">Zero</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="var">easy</span>));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
When two quantities have a supremum, smaller quantities also do. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">sup_defined_Subusage</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">r1</span> <span class="id" title="var">r2</span> <span class="id" title="var">s</span> <span class="id" title="var">r2s</span> : <span class="id" title="var">Quantity</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">sup</span> <span class="id" title="var">r2</span> <span class="id" title="var">s</span> = <span class="id" title="var">Some</span> <span class="id" title="var">r2s</span> -&gt; <span class="id" title="var">Subusage</span> <span class="id" title="var">r1</span> <span class="id" title="var">r2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">r1s</span> : <span class="id" title="var">Quantity</span>, <span class="id" title="var">sup</span> <span class="id" title="var">r1</span> <span class="id" title="var">s</span> = <span class="id" title="var">Some</span> <span class="id" title="var">r1s</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">intros</span> <span class="id" title="var">r1</span> [] []; <span class="id" title="var">cbn</span>; <span class="id" title="tactic">do</span> 2 <span class="id" title="tactic">inversion</span> 1; <span class="id" title="tactic">subst</span>; <span class="id" title="var">cbn</span>; <span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" title="var">sup</span></span> preserves <span class="inlinecode"><span class="id" title="var">Subusage</span></span> in both arguments. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">Subusage_sup_sup</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">r1</span> <span class="id" title="var">r2</span> <span class="id" title="var">s1</span> <span class="id" title="var">s2</span> <span class="id" title="var">r1s1</span> <span class="id" title="var">r2s2</span> : <span class="id" title="var">Quantity</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">sup</span> <span class="id" title="var">r1</span> <span class="id" title="var">s1</span> = <span class="id" title="var">Some</span> <span class="id" title="var">r1s1</span> -&gt; <span class="id" title="var">sup</span> <span class="id" title="var">r2</span> <span class="id" title="var">s2</span> = <span class="id" title="var">Some</span> <span class="id" title="var">r2s2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Subusage</span> <span class="id" title="var">r1</span> <span class="id" title="var">r2</span> -&gt; <span class="id" title="var">Subusage</span> <span class="id" title="var">s1</span> <span class="id" title="var">s2</span> -&gt; <span class="id" title="var">Subusage</span> <span class="id" title="var">r1s1</span> <span class="id" title="var">r2s2</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">r1</span> <span class="id" title="var">r2</span> <span class="id" title="var">s1</span> <span class="id" title="var">s2</span> <span class="id" title="var">r1s1</span> <span class="id" title="var">r2s2</span> <span class="id" title="var">H1</span> <span class="id" title="var">H2</span> <span class="id" title="var">Hr</span> <span class="id" title="var">Hs</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">sup_defined_Subusage</span> <span class="id" title="var">r1</span> <span class="id" title="var">r2</span> <span class="id" title="var">s2</span> <span class="id" title="var">_</span> <span class="id" title="var">H2</span> <span class="id" title="var">Hr</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">r1s2</span> <span class="id" title="var">H</span>].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">transitivity</span> <span class="id" title="var">r1s2</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">now</span> <span class="id" title="tactic">destruct</span> <span class="id" title="var">r1</span>, <span class="id" title="var">s1</span>, <span class="id" title="var">s2</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">H1</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">H2</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>; <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">now</span> <span class="id" title="tactic">destruct</span> <span class="id" title="var">r1</span>, <span class="id" title="var">r2</span>, <span class="id" title="var">s2</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">H1</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">H2</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>; <span class="id" title="var">cbn</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
The algebraic and order structures are related in the usual way. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">Subusage_iff_sup_eq</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> : <span class="id" title="var">Quantity</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Subusage</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> &lt;-&gt; <span class="id" title="var">sup</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> = <span class="id" title="var">Some</span> <span class="id" title="var">s</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">intros</span> [] []; <span class="id" title="var">cbn</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab1228"></a><h2 class="section">Absorbption and distributivity laws</h2>

<div class="paragraph"> </div>

 Absorption laws for <span class="inlinecode"><span class="id" title="var">sup</span></span>. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">sup_inf_l</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> : <span class="id" title="var">Quantity</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">sup</span> (<span class="id" title="var">inf</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span>) <span class="id" title="var">s</span> = <span class="id" title="var">Some</span> <span class="id" title="var">s</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">intros</span> [] []; <span class="id" title="var">cbn</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">sup_inf_r</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> : <span class="id" title="var">Quantity</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">sup</span> <span class="id" title="var">r</span> (<span class="id" title="var">inf</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span>) = <span class="id" title="var">Some</span> <span class="id" title="var">r</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">intros</span> [] []; <span class="id" title="var">cbn</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Absorption laws for <span class="inlinecode"><span class="id" title="var">inf</span></span>. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">inf_sup_l</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> <span class="id" title="var">rs</span> : <span class="id" title="var">Quantity</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">sup</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> = <span class="id" title="var">Some</span> <span class="id" title="var">rs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">inf</span> <span class="id" title="var">rs</span> <span class="id" title="var">s</span> = <span class="id" title="var">s</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">intros</span> [] [] <span class="id" title="var">rs</span>; <span class="id" title="tactic">inversion</span> 1; <span class="id" title="tactic">subst</span>; <span class="id" title="var">cbn</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">inf_sup_r</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> <span class="id" title="var">rs</span> : <span class="id" title="var">Quantity</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">sup</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> = <span class="id" title="var">Some</span> <span class="id" title="var">rs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">inf</span> <span class="id" title="var">r</span> <span class="id" title="var">rs</span> = <span class="id" title="var">r</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">intros</span> [] [] <span class="id" title="var">rs</span>; <span class="id" title="tactic">inversion</span> 1; <span class="id" title="tactic">subst</span>; <span class="id" title="var">cbn</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Distributivity laws. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">sup_inf_inf_l</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> <span class="id" title="var">t</span> <span class="id" title="var">st</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">sup</span> <span class="id" title="var">s</span> <span class="id" title="var">t</span> = <span class="id" title="var">Some</span> <span class="id" title="var">st</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">sup</span> (<span class="id" title="var">inf</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span>) (<span class="id" title="var">inf</span> <span class="id" title="var">r</span> <span class="id" title="var">t</span>) = <span class="id" title="var">Some</span> (<span class="id" title="var">inf</span> <span class="id" title="var">r</span> <span class="id" title="var">st</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">intros</span> [] [] []; <span class="id" title="var">cbn</span>; <span class="id" title="tactic">inversion</span> 1; <span class="id" title="tactic">subst</span>; <span class="id" title="var">cbn</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">sup_inf_inf_r</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> <span class="id" title="var">t</span> <span class="id" title="var">rs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">sup</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> = <span class="id" title="var">Some</span> <span class="id" title="var">rs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">sup</span> (<span class="id" title="var">inf</span> <span class="id" title="var">r</span> <span class="id" title="var">t</span>) (<span class="id" title="var">inf</span> <span class="id" title="var">s</span> <span class="id" title="var">t</span>) = <span class="id" title="var">Some</span> (<span class="id" title="var">inf</span> <span class="id" title="var">rs</span> <span class="id" title="var">t</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">intros</span> [] [] []; <span class="id" title="var">cbn</span>; <span class="id" title="tactic">inversion</span> 1; <span class="id" title="tactic">subst</span>; <span class="id" title="var">cbn</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab1229"></a><h1 class="section">Subtraction</h1>


<div class="paragraph"> </div>

  Subtraction is the inverse of addition, i.e. <code>r - s = q</code> when <code>r = q + s</code>.
  However, for quantities, just like for natural numbers (and unlike the integers),
  subtraction is not always possible, so sometimes the result is not defined.

<div class="paragraph"> </div>

  However, we can put some effort into making subtraction "as defined as possible".
  To do this, we will not require the result to satisfy the above equation exactly,
  but only to be its best approximation, i.e. we will want to define <code>r - s</code>
  as the least <code>q</code> in the <span class="inlinecode"><span class="id" title="var">Subusage</span></span> ordering that satisfies <code>r &lt;= q + s</code>.

<div class="paragraph"> </div>

  This time we won't even dream about finding a nice characterization to replace
  the explicit definition below - a subtraction table is the best we can hope for,
  even though it's easy to notice some patterns in it.

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">sub</span> (<span class="id" title="var">r</span> <span class="id" title="var">s</span> : <span class="id" title="var">Quantity</span>) : <span class="id" title="var">option</span> <span class="id" title="var">Quantity</span> :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="var">r</span>, <span class="id" title="var">s</span> <span class="id" title="keyword">with</span><br/>
| <span class="id" title="var">Any</span> , <span class="id" title="var">_</span>    =&gt; <span class="id" title="var">Some</span> <span class="id" title="var">Any</span><br/>
| <span class="id" title="var">_</span>   , <span class="id" title="var">Zero</span> =&gt; <span class="id" title="var">Some</span> <span class="id" title="var">r</span><br/>
| <span class="id" title="var">Zero</span>, <span class="id" title="var">_</span>    =&gt; <span class="id" title="var">None</span><br/>
| <span class="id" title="var">One</span> , <span class="id" title="var">One</span>  =&gt; <span class="id" title="var">Some</span> <span class="id" title="var">Zero</span><br/>
| <span class="id" title="var">One</span> , <span class="id" title="var">_</span>    =&gt; <span class="id" title="var">None</span><br/>
| <span class="id" title="var">Few</span> , <span class="id" title="var">One</span>  =&gt; <span class="id" title="var">Some</span> <span class="id" title="var">Zero</span><br/>
| <span class="id" title="var">Few</span> , <span class="id" title="var">Few</span>  =&gt; <span class="id" title="var">Some</span> <span class="id" title="var">Zero</span><br/>
| <span class="id" title="var">Few</span> , <span class="id" title="var">_</span>    =&gt; <span class="id" title="var">None</span><br/>
| <span class="id" title="var">Many</span>, <span class="id" title="var">One</span>  =&gt; <span class="id" title="var">Some</span> <span class="id" title="var">Any</span><br/>
| <span class="id" title="var">Many</span>, <span class="id" title="var">Few</span>  =&gt; <span class="id" title="var">Some</span> <span class="id" title="var">Many</span><br/>
| <span class="id" title="var">Many</span>, <span class="id" title="var">Many</span> =&gt; <span class="id" title="var">Some</span> <span class="id" title="var">Any</span><br/>
| <span class="id" title="var">Many</span>, <span class="id" title="var">Any</span>  =&gt; <span class="id" title="var">Some</span> <span class="id" title="var">Many</span><br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" title="var">sub</span></span> indeed satisfies its specification. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">sub_spec_ex</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> <span class="id" title="var">rs</span> : <span class="id" title="var">Quantity</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">sub</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> = <span class="id" title="var">Some</span> <span class="id" title="var">rs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Subusage</span> <span class="id" title="var">r</span> (<span class="id" title="var">add</span> <span class="id" title="var">rs</span> <span class="id" title="var">s</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">intros</span> [] [] <span class="id" title="var">rs</span>; <span class="id" title="tactic">inversion</span> 1; <span class="id" title="tactic">subst</span>; <span class="id" title="var">cbn</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">sub_spec_uniq</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> <span class="id" title="var">rs</span> : <span class="id" title="var">Quantity</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">sub</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> = <span class="id" title="var">Some</span> <span class="id" title="var">rs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">t</span> : <span class="id" title="var">Quantity</span>, <span class="id" title="var">Subusage</span> <span class="id" title="var">r</span> (<span class="id" title="var">add</span> <span class="id" title="var">t</span> <span class="id" title="var">s</span>) -&gt; <span class="id" title="var">Subusage</span> <span class="id" title="var">rs</span> <span class="id" title="var">t</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">intros</span> [] [] <span class="id" title="var">rs</span>; <span class="id" title="tactic">inversion</span> 1; <span class="id" title="tactic">intros</span> []; <span class="id" title="tactic">inversion</span> 1; <span class="id" title="tactic">subst</span>; <span class="id" title="var">cbn</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" title="var">sub</span></span> is the unique function that satisfies its specification. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">sub_spec</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> <span class="id" title="var">rs</span> : <span class="id" title="var">Quantity</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">sub</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> = <span class="id" title="var">Some</span> <span class="id" title="var">rs</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Subusage</span> <span class="id" title="var">r</span> (<span class="id" title="var">add</span> <span class="id" title="var">rs</span> <span class="id" title="var">s</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">q</span> : <span class="id" title="var">Quantity</span>, <span class="id" title="var">Subusage</span> <span class="id" title="var">r</span> (<span class="id" title="var">add</span> <span class="id" title="var">q</span> <span class="id" title="var">s</span>) -&gt; <span class="id" title="var">Subusage</span> <span class="id" title="var">rs</span> <span class="id" title="var">q</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">sub_spec_ex</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">sub_spec_uniq</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> [<span class="id" title="var">Hex</span> <span class="id" title="var">Huniq</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;The&nbsp;match&nbsp;finds&nbsp;a&nbsp;contradictory&nbsp;instantiation&nbsp;of&nbsp;the&nbsp;hypothesis.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">destruct</span> <span class="id" title="var">r</span>, <span class="id" title="var">s</span>, <span class="id" title="var">rs</span>; <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">H</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">_</span>, <span class="id" title="var">Subusage</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> -&gt; <span class="id" title="var">Subusage</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> |- <span class="id" title="var">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">H</span> <span class="id" title="var">Any</span>  <span class="id" title="keyword">ltac</span>:(<span class="id" title="var">easy</span>)) +<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">H</span> <span class="id" title="var">Many</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="var">easy</span>)) +<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">H</span> <span class="id" title="var">One</span>  <span class="id" title="keyword">ltac</span>:(<span class="id" title="var">easy</span>)) +<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">H</span> <span class="id" title="var">Zero</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="var">easy</span>));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
  For ordinary numbers, <code>x - x = 0</code>. For quantities, however, this is not the
  case and the best we can get is <code>r - r &lt;= 0</code>.

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">Subusage_sub_Zero</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> <span class="id" title="var">rr</span> : <span class="id" title="var">Quantity</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">sub</span> <span class="id" title="var">r</span> <span class="id" title="var">r</span> = <span class="id" title="var">Some</span> <span class="id" title="var">rr</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Subusage</span> <span class="id" title="var">rr</span> <span class="id" title="var">Zero</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">intros</span> [] <span class="id" title="var">rr</span>; <span class="id" title="tactic">inversion</span> 1.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab1230"></a><h2 class="section">Subtraction order</h2>


<div class="paragraph"> </div>

  <span class="inlinecode"><span class="id" title="var">SubtractionOrder</span></span> is a decidable total preorder that arises from subtraction,
  i.e. <code>r &lt;= s</code> if and only if <code>s - r</code> is defined.

<div class="paragraph"> </div>

  We define it explicitly as <code>Zero &lt;= One &lt;= Few &lt;= Many &lt;= Any &lt;= Many</code>.

<div class="paragraph"> </div>

  Note that according to this order, <span class="inlinecode"><span class="id" title="var">Many</span></span> and <span class="inlinecode"><span class="id" title="var">Any</span></span> are equivalent, therefore
  it is not antisymmetric and thus not a partial order.

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">SubtractionOrder</span> : <span class="id" title="var">Quantity</span> -&gt; <span class="id" title="var">Quantity</span> -&gt; <span class="id" title="keyword">Prop</span> :=<br/>
| <span class="id" title="var">SubtractionOrder_refl</span>    : <span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> : <span class="id" title="var">Quantity</span>, <span class="id" title="var">SubtractionOrder</span> <span class="id" title="var">r</span> <span class="id" title="var">r</span><br/>
| <span class="id" title="var">SubtractionOrder_Zero_l</span>  : <span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> : <span class="id" title="var">Quantity</span>, <span class="id" title="var">SubtractionOrder</span> <span class="id" title="var">Zero</span> <span class="id" title="var">r</span><br/>
| <span class="id" title="var">SubtractionOrder_Many_r</span>  : <span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> : <span class="id" title="var">Quantity</span>, <span class="id" title="var">SubtractionOrder</span> <span class="id" title="var">r</span> <span class="id" title="var">Many</span><br/>
| <span class="id" title="var">SubtractionOrder_Any_r</span>   : <span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> : <span class="id" title="var">Quantity</span>, <span class="id" title="var">SubtractionOrder</span> <span class="id" title="var">r</span> <span class="id" title="var">Any</span><br/>
| <span class="id" title="var">SubtractionOrder_One_Few</span> : <span class="id" title="var">SubtractionOrder</span> <span class="id" title="var">One</span> <span class="id" title="var">Few</span>.<br/>

<br/>
#[<span class="id" title="var">export</span>] <span class="id" title="keyword">Hint</span> <span class="id" title="keyword">Constructors</span> <span class="id" title="var">SubtractionOrder</span> : <span class="id" title="var">core</span>.<br/>

<br/>
</div>

<div class="doc">
The explicit definition is equivalent to the one based on subtraction. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">SubtractionOrder_spec</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> : <span class="id" title="var">Quantity</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">SubtractionOrder</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> &lt;-&gt; <span class="id" title="var">sub</span> <span class="id" title="var">s</span> <span class="id" title="var">r</span> &lt;&gt; <span class="id" title="var">None</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">intros</span> [] []; <span class="id" title="var">cbn</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
#[<span class="id" title="var">export</span>] <span class="id" title="keyword">Instance</span> <span class="id" title="var">PreOrder_SubtractionOrder</span> :<br/>
&nbsp;&nbsp;<span class="id" title="var">PreOrder</span> <span class="id" title="var">SubtractionOrder</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">split</span>; <span class="id" title="tactic">red</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">now</span> <span class="id" title="tactic">do</span> 2 <span class="id" title="tactic">inversion</span> 1.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">Total_SubtractionOrder</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> : <span class="id" title="var">Quantity</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">SubtractionOrder</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> \/ <span class="id" title="var">SubtractionOrder</span> <span class="id" title="var">s</span> <span class="id" title="var">r</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">intros</span> [] []; <span class="id" title="var">cbn</span>; <span class="id" title="tactic">firstorder</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
#[<span class="id" title="tactic">refine</span>, <span class="id" title="var">export</span>] <span class="id" title="keyword">Instance</span> <span class="id" title="var">Decidable_SubtractionOrder</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> : <span class="id" title="var">Quantity</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Decidable</span> (<span class="id" title="var">SubtractionOrder</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span>) :=<br/>
{<br/>
&nbsp;&nbsp;<span class="id" title="var">Decidable_witness</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">r</span>, <span class="id" title="var">s</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Zero</span>, <span class="id" title="var">_</span>    =&gt; <span class="id" title="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span>   , <span class="id" title="var">Many</span> =&gt; <span class="id" title="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span>   , <span class="id" title="var">Any</span>  =&gt; <span class="id" title="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">One</span> , <span class="id" title="var">Few</span>  =&gt; <span class="id" title="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span>   , <span class="id" title="var">_</span>    =&gt; <span class="id" title="var">decide</span> (<span class="id" title="var">r</span> = <span class="id" title="var">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>;<br/>
}.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">destruct</span> <span class="id" title="var">r</span>, <span class="id" title="var">s</span>; <span class="id" title="var">cbn</span>.<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab1231"></a><h2 class="section">Decrementation order</h2>


<div class="paragraph"> </div>

  <span class="inlinecode"><span class="id" title="var">DecrementationOrder</span></span> is a decidable transitive relation (which is not
  reflexive, hence not an actual "order") that arises from decrementation,
  i.e. <code>r &lt;= s</code> if and only if <code>r = s - One</code>.

<div class="paragraph"> </div>

  We define it explicitly as:
<ul class="doclist">
<li> <code>Zero &lt;= One</code>

</li>
<li> <code>Zero &lt;= Few</code>

</li>
<li> <code>Any &lt;= Many</code>

</li>
<li> <code>Any &lt;= Any</code>

</li>
</ul>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">DecrementationOrder</span> : <span class="id" title="var">Quantity</span> -&gt; <span class="id" title="var">Quantity</span> -&gt; <span class="id" title="keyword">Prop</span> :=<br/>
| <span class="id" title="var">DecrementationOrder_Zero_One</span> : <span class="id" title="var">DecrementationOrder</span> <span class="id" title="var">Zero</span> <span class="id" title="var">One</span><br/>
| <span class="id" title="var">DecrementationOrder_Zero_Few</span> : <span class="id" title="var">DecrementationOrder</span> <span class="id" title="var">Zero</span> <span class="id" title="var">Few</span><br/>
| <span class="id" title="var">DecrementationOrder_Any_Many</span> : <span class="id" title="var">DecrementationOrder</span> <span class="id" title="var">Any</span> <span class="id" title="var">Many</span><br/>
| <span class="id" title="var">DecrementationOrder_Any_Any</span>  : <span class="id" title="var">DecrementationOrder</span> <span class="id" title="var">Any</span> <span class="id" title="var">Any</span>.<br/>

<br/>
#[<span class="id" title="var">export</span>] <span class="id" title="keyword">Hint</span> <span class="id" title="keyword">Constructors</span> <span class="id" title="var">DecrementationOrder</span> : <span class="id" title="var">core</span>.<br/>

<br/>
</div>

<div class="doc">
The explicit definition is equivalent to the one based on decrementation. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">DecrementationOrder_spec</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> : <span class="id" title="var">Quantity</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">DecrementationOrder</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> &lt;-&gt; <span class="id" title="var">sub</span> <span class="id" title="var">s</span> <span class="id" title="var">One</span> = <span class="id" title="var">Some</span> <span class="id" title="var">r</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">intros</span> [] []; <span class="id" title="var">cbn</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
#[<span class="id" title="var">export</span>] <span class="id" title="keyword">Instance</span> <span class="id" title="var">Transitive_DecrementationOrder</span> :<br/>
&nbsp;&nbsp;<span class="id" title="var">Transitive</span> <span class="id" title="var">DecrementationOrder</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">do</span> 2 <span class="id" title="tactic">inversion</span> 1; <span class="id" title="tactic">subst</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
#[<span class="id" title="tactic">refine</span>, <span class="id" title="var">export</span>] <span class="id" title="keyword">Instance</span> <span class="id" title="var">Decidable_DecrementationOrder</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> : <span class="id" title="var">Quantity</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Decidable</span> (<span class="id" title="var">DecrementationOrder</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span>) :=<br/>
{<br/>
&nbsp;&nbsp;<span class="id" title="var">Decidable_witness</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">r</span>, <span class="id" title="var">s</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Zero</span>, <span class="id" title="var">One</span>  =&gt; <span class="id" title="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Zero</span>, <span class="id" title="var">Few</span>  =&gt; <span class="id" title="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Any</span> , <span class="id" title="var">Many</span> =&gt; <span class="id" title="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Any</span> , <span class="id" title="var">Any</span>  =&gt; <span class="id" title="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span>   , <span class="id" title="var">_</span>    =&gt; <span class="id" title="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>;<br/>
}.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">destruct</span> <span class="id" title="var">r</span>, <span class="id" title="var">s</span>; <span class="id" title="var">cbn</span>.<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
The decrementation order embeds into the subtraction order. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">SubtractionOrder_DecrementationOrder</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> : <span class="id" title="var">Quantity</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">DecrementationOrder</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> -&gt; <span class="id" title="var">SubtractionOrder</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">inversion</span> 1.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab1232"></a><h1 class="section">Division</h1>


<div class="paragraph"> </div>

  In this section we will define some operations that resemble division,
  but things won't be as neat as with subtraction.

<div class="paragraph"> </div>

<a id="lab1233"></a><h2 class="section">Division with remainder</h2>


<div class="paragraph"> </div>

  We want to define division with remainder so that <code>r / s = (a, b)</code> when
  <code>a</code> is the greatest and <code>b</code> is the least element (both in the subtraction order)
  that satisfy <code>r = a * s + b</code>.

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">divmod</span> (<span class="id" title="var">r</span> <span class="id" title="var">s</span> : <span class="id" title="var">Quantity</span>) : <span class="id" title="var">Quantity</span> * <span class="id" title="var">Quantity</span> :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="var">r</span>, <span class="id" title="var">s</span> <span class="id" title="keyword">with</span><br/>
| <span class="id" title="var">_</span>   , <span class="id" title="var">Zero</span> =&gt; (<span class="id" title="var">Any</span> , <span class="id" title="var">r</span>)<br/>
| <span class="id" title="var">_</span>   , <span class="id" title="var">One</span>  =&gt; (<span class="id" title="var">r</span>   , <span class="id" title="var">Zero</span>)<br/>
| <span class="id" title="var">Zero</span>, <span class="id" title="var">_</span>    =&gt; (<span class="id" title="var">Zero</span>, <span class="id" title="var">Zero</span>)<br/>
| <span class="id" title="var">One</span> , <span class="id" title="var">_</span>    =&gt; (<span class="id" title="var">Zero</span>, <span class="id" title="var">One</span>)<br/>
| <span class="id" title="var">Any</span> , <span class="id" title="var">_</span>    =&gt; (<span class="id" title="var">Any</span> , <span class="id" title="var">Zero</span>)<br/>
| <span class="id" title="var">Few</span> , <span class="id" title="var">Few</span>  =&gt; (<span class="id" title="var">Few</span> , <span class="id" title="var">Zero</span>)<br/>
| <span class="id" title="var">Few</span> , <span class="id" title="var">_</span>    =&gt; (<span class="id" title="var">Zero</span>, <span class="id" title="var">Few</span>)<br/>
| <span class="id" title="var">Many</span>, <span class="id" title="var">Few</span>  =&gt; (<span class="id" title="var">Any</span> , <span class="id" title="var">One</span>)<br/>
| <span class="id" title="var">Many</span>, <span class="id" title="var">Many</span> =&gt; (<span class="id" title="var">Many</span>, <span class="id" title="var">Zero</span>)<br/>
| <span class="id" title="var">Many</span>, <span class="id" title="var">Any</span>  =&gt; (<span class="id" title="var">Any</span> , <span class="id" title="var">One</span>)<br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<code>r / 0</code> is <span class="inlinecode"><span class="id" title="var">Any</span></span> with remainder <code>r</code>. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">divmod_Zero_r</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> : <span class="id" title="var">Quantity</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">divmod</span> <span class="id" title="var">r</span> <span class="id" title="var">Zero</span> = (<span class="id" title="var">Any</span>, <span class="id" title="var">r</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">intros</span> []; <span class="id" title="var">cbn</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<code>r / 1</code> is <code>1</code> with remainder <code>0</code>. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">divmod_One_r</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> : <span class="id" title="var">Quantity</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">divmod</span> <span class="id" title="var">r</span> <span class="id" title="var">One</span> = (<span class="id" title="var">r</span>, <span class="id" title="var">Zero</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">intros</span> []; <span class="id" title="var">cbn</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" title="var">divmod</span></span> satisfies its specification. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">divmod_add_mul</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span> : <span class="id" title="var">Quantity</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">divmod</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> = (<span class="id" title="var">a</span>, <span class="id" title="var">b</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">r</span> = <span class="id" title="var">add</span> (<span class="id" title="var">mul</span> <span class="id" title="var">a</span> <span class="id" title="var">s</span>) <span class="id" title="var">b</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">intros</span> [] [] <span class="id" title="var">a</span> <span class="id" title="var">b</span> [= &lt;- &lt;-]; <span class="id" title="var">cbn</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">SubtractionOrder_divmod_1</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span> : <span class="id" title="var">Quantity</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">divmod</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> = (<span class="id" title="var">a</span>, <span class="id" title="var">b</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">a'</span> <span class="id" title="var">b'</span> : <span class="id" title="var">Quantity</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">r</span> = <span class="id" title="var">add</span> (<span class="id" title="var">mul</span> <span class="id" title="var">a'</span> <span class="id" title="var">s</span>) <span class="id" title="var">b'</span> -&gt; <span class="id" title="var">SubtractionOrder</span> <span class="id" title="var">a'</span> <span class="id" title="var">a</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">intros</span> [] [] <span class="id" title="var">a</span> <span class="id" title="var">b</span> [= &lt;- &lt;-] [] []; <span class="id" title="var">cbn</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">SubtractionOrder_divmod_2</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span> : <span class="id" title="var">Quantity</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">divmod</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> = (<span class="id" title="var">a</span>, <span class="id" title="var">b</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">a'</span> <span class="id" title="var">b'</span> : <span class="id" title="var">Quantity</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">r</span> = <span class="id" title="var">add</span> (<span class="id" title="var">mul</span> <span class="id" title="var">a'</span> <span class="id" title="var">s</span>) <span class="id" title="var">b'</span> -&gt; <span class="id" title="var">SubtractionOrder</span> <span class="id" title="var">b</span> <span class="id" title="var">b'</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">intros</span> [] [] <span class="id" title="var">a</span> <span class="id" title="var">b</span> [= &lt;- &lt;-] [] []; <span class="id" title="var">cbn</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
  While <span class="inlinecode"><span class="id" title="var">divmod</span></span> satisfies its specification, it is not the unique function
  that does so - this is because we could have made some different choices
  in the cases of <span class="inlinecode"><span class="id" title="var">Many</span></span> divided by <span class="inlinecode"><span class="id" title="var">One</span></span> and <span class="inlinecode"><span class="id" title="var">Many</span></span>.

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">divmod_spec</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span> : <span class="id" title="var">Quantity</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">divmod</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> = (<span class="id" title="var">a</span>, <span class="id" title="var">b</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">r</span> = <span class="id" title="var">add</span> (<span class="id" title="var">mul</span> <span class="id" title="var">a</span> <span class="id" title="var">s</span>) <span class="id" title="var">b</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">a'</span> <span class="id" title="var">b'</span> : <span class="id" title="var">Quantity</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">r</span> = <span class="id" title="var">add</span> (<span class="id" title="var">mul</span> <span class="id" title="var">a'</span> <span class="id" title="var">s</span>) <span class="id" title="var">b'</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">SubtractionOrder</span> <span class="id" title="var">a'</span> <span class="id" title="var">a</span> /\ <span class="id" title="var">SubtractionOrder</span> <span class="id" title="var">b</span> <span class="id" title="var">b'</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">split</span>; [| <span class="id" title="tactic">split</span>].<br/>
&nbsp;&nbsp;- <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">divmod_add_mul</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">now</span> <span class="id" title="tactic">eapply</span> <span class="id" title="var">SubtractionOrder_divmod_1</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">now</span> <span class="id" title="tactic">eapply</span> <span class="id" title="var">SubtractionOrder_divmod_2</span>; <span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab1234"></a><h2 class="section">Trait ordering</h2>


<div class="paragraph"> </div>

  Before we introduce the next kind of division, we need a new ordering to
  specify it. The trait ordering is almost like the subusage ordering, but
  <code>0</code> is above <code>1</code>.

</div>
<div class="code">

<br/>
<span class="comment">(*<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/&nbsp;\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/&nbsp;&nbsp;&nbsp;\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;?&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\&nbsp;&nbsp;&nbsp;/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\&nbsp;/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br/>
*)</span><br/>

<br/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">TraitOrder</span> : <span class="id" title="var">Quantity</span> -&gt; <span class="id" title="var">Quantity</span> -&gt; <span class="id" title="keyword">Prop</span> :=<br/>
| <span class="id" title="var">TraitOrder_refl</span>     : <span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> : <span class="id" title="var">Quantity</span>, <span class="id" title="var">TraitOrder</span> <span class="id" title="var">r</span> <span class="id" title="var">r</span><br/>
| <span class="id" title="var">TraitOrder_Any_l</span>    : <span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> : <span class="id" title="var">Quantity</span>, <span class="id" title="var">TraitOrder</span> <span class="id" title="var">Any</span> <span class="id" title="var">r</span><br/>
| <span class="id" title="var">TraitOrder_Zero_r</span>   : <span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> : <span class="id" title="var">Quantity</span>, <span class="id" title="var">TraitOrder</span> <span class="id" title="var">r</span> <span class="id" title="var">Zero</span><br/>
| <span class="id" title="var">TraitOrder_Few_One</span>  : <span class="id" title="var">TraitOrder</span> <span class="id" title="var">Few</span> <span class="id" title="var">One</span><br/>
| <span class="id" title="var">TraitOrder_Many_One</span> : <span class="id" title="var">TraitOrder</span> <span class="id" title="var">Many</span> <span class="id" title="var">One</span><br/>
| <span class="id" title="var">TraitOrder_One_Zero</span> : <span class="id" title="var">TraitOrder</span> <span class="id" title="var">One</span> <span class="id" title="var">Zero</span>.<br/>

<br/>
#[<span class="id" title="var">export</span>] <span class="id" title="keyword">Hint</span> <span class="id" title="keyword">Constructors</span> <span class="id" title="var">TraitOrder</span> : <span class="id" title="var">core</span>.<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" title="var">TraitOrder</span></span> is a decidable partial order. 
</div>
<div class="code">

<br/>
#[<span class="id" title="var">export</span>] <span class="id" title="keyword">Instance</span> <span class="id" title="var">PreOrder_TraitOrder</span> :<br/>
&nbsp;&nbsp;<span class="id" title="var">PreOrder</span> <span class="id" title="var">TraitOrder</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">split</span>; <span class="id" title="tactic">red</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">now</span> <span class="id" title="tactic">do</span> 2 <span class="id" title="tactic">inversion</span> 1; <span class="id" title="tactic">subst</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
#[<span class="id" title="var">export</span>] <span class="id" title="keyword">Instance</span> <span class="id" title="var">Antisymmetric_TraitOrder</span> :<br/>
&nbsp;&nbsp;<span class="id" title="var">Antisymmetric</span> <span class="id" title="var">_</span> <span class="id" title="var">eq</span> <span class="id" title="var">TraitOrder</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">do</span> 2 <span class="id" title="tactic">inversion</span> 1; <span class="id" title="tactic">subst</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
#[<span class="id" title="tactic">refine</span>, <span class="id" title="var">export</span>] <span class="id" title="keyword">Instance</span> <span class="id" title="var">Decidable_TraitOrder</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> : <span class="id" title="var">Quantity</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Decidable</span> (<span class="id" title="var">TraitOrder</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span>) :=<br/>
{<br/>
&nbsp;&nbsp;<span class="id" title="var">Decidable_witness</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">r</span>, <span class="id" title="var">s</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Any</span> , <span class="id" title="var">_</span>    =&gt; <span class="id" title="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span>   , <span class="id" title="var">Zero</span> =&gt; <span class="id" title="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Few</span> , <span class="id" title="var">One</span>  =&gt; <span class="id" title="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Many</span>, <span class="id" title="var">One</span>  =&gt; <span class="id" title="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span>   , <span class="id" title="var">_</span>    =&gt; <span class="id" title="var">decide</span> (<span class="id" title="var">r</span> = <span class="id" title="var">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>;<br/>
}.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">destruct</span> <span class="id" title="var">r</span>, <span class="id" title="var">s</span>; <span class="id" title="var">cbn</span>.<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" title="var">complement</span></span> flips <span class="inlinecode"><span class="id" title="var">TraitOrder</span></span>, but only on traits. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">TraitOrder_complement</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> : <span class="id" title="var">Quantity</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">TraitOrder</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> -&gt; <span class="id" title="var">s</span> = <span class="id" title="var">Zero</span> \/ <span class="id" title="var">TraitOrder</span> (<span class="id" title="var">complement</span> <span class="id" title="var">s</span>) (<span class="id" title="var">complement</span> <span class="id" title="var">r</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">intros</span> <span class="id" title="var">r</span> []; <span class="id" title="tactic">inversion</span> 1; <span class="id" title="var">cbn</span>; <span class="id" title="tactic">firstorder</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" title="var">Subusage</span></span> embeds in <span class="inlinecode"><span class="id" title="var">TraitOrder</span></span>. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">TraitOrder_Subusage</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> : <span class="id" title="var">Quantity</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Subusage</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> -&gt; <span class="id" title="var">TraitOrder</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">inversion</span> 1.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab1235"></a><h2 class="section">Trait division</h2>


<div class="paragraph"> </div>

  We might also define a different kind of division, which we'll call
  "trait division", because it is a kind of inverse of multiplication,
  while also being closely related to traits. We might think that <code>div r s</code>
  answers the question: when we have the trait <code>r</code> but need the trait <code>s</code>,
  what trait are we missing? It is in some sense a generalization of the
  <span class="inlinecode"><span class="id" title="var">complement</span></span> operation, which answers the same question when <code>r</code> is <span class="inlinecode"><span class="id" title="var">Any</span></span>.

<div class="paragraph"> </div>

  The formal specification is as follows: <code>r / s</code> is the greatest <code>q</code> in
  the trait ordering that satisfies <code>q * s &lt;= r</code>.

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">div</span> (<span class="id" title="var">r</span> <span class="id" title="var">s</span> : <span class="id" title="var">Quantity</span>) : <span class="id" title="var">option</span> <span class="id" title="var">Quantity</span> :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="var">r</span>, <span class="id" title="var">s</span> <span class="id" title="keyword">with</span><br/>
| <span class="id" title="var">Zero</span>, <span class="id" title="var">_</span>    =&gt; <span class="id" title="var">Some</span> <span class="id" title="var">Zero</span><br/>
| <span class="id" title="var">_</span>   , <span class="id" title="var">Zero</span> =&gt; <span class="id" title="var">None</span><br/>
| <span class="id" title="var">Any</span> , <span class="id" title="var">r</span>    =&gt; <span class="id" title="var">Some</span> (<span class="id" title="var">complement</span> <span class="id" title="var">r</span>)<br/>
| <span class="id" title="var">_</span>   , <span class="id" title="var">_</span>    =&gt; <span class="id" title="keyword">if</span> <span class="id" title="var">decide</span> (<span class="id" title="var">TraitOrder</span> <span class="id" title="var">s</span> <span class="id" title="var">r</span>) <span class="id" title="keyword">then</span> <span class="id" title="var">Some</span> <span class="id" title="var">One</span> <span class="id" title="keyword">else</span> <span class="id" title="var">Some</span> <span class="id" title="var">r</span><br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" title="var">div</span></span> indeed satisfies its specification. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">div_spec</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> <span class="id" title="var">rs</span> : <span class="id" title="var">Quantity</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">div</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> = <span class="id" title="var">Some</span> <span class="id" title="var">rs</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">TraitOrder</span> (<span class="id" title="var">mul</span> <span class="id" title="var">rs</span> <span class="id" title="var">s</span>) <span class="id" title="var">r</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">q</span> : <span class="id" title="var">Quantity</span>, <span class="id" title="var">TraitOrder</span> (<span class="id" title="var">mul</span> <span class="id" title="var">q</span> <span class="id" title="var">s</span>) <span class="id" title="var">r</span> -&gt; <span class="id" title="var">TraitOrder</span> <span class="id" title="var">q</span> <span class="id" title="var">rs</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">now</span> <span class="id" title="tactic">destruct</span> <span class="id" title="var">r</span>, <span class="id" title="var">s</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">now</span> <span class="id" title="tactic">destruct</span> <span class="id" title="var">r</span>, <span class="id" title="var">s</span>, <span class="id" title="var">q</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> [<span class="id" title="var">Hex</span> <span class="id" title="var">Huniq</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">destruct</span> <span class="id" title="var">r</span>, <span class="id" title="var">s</span>, <span class="id" title="var">rs</span>; <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">H</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">_</span>, <span class="id" title="var">TraitOrder</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> -&gt; <span class="id" title="var">TraitOrder</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> |- <span class="id" title="var">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">H</span> <span class="id" title="var">Many</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="var">easy</span>)) +<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">H</span> <span class="id" title="var">Few</span>  <span class="id" title="keyword">ltac</span>:(<span class="id" title="var">easy</span>)) +<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">H</span> <span class="id" title="var">Zero</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="var">easy</span>));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab1236"></a><h3 class="section">Alternative definitions</h3>

<div class="paragraph"> </div>


<div class="paragraph"> </div>

  We could have used <span class="inlinecode"><span class="id" title="var">Subusage</span></span> in the definition of <span class="inlinecode"><span class="id" title="var">div</span></span>, but the
  specification will still talk about <span class="inlinecode"><span class="id" title="var">TraitOrder</span></span>.

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">div'</span> (<span class="id" title="var">r</span> <span class="id" title="var">s</span> : <span class="id" title="var">Quantity</span>) : <span class="id" title="var">option</span> <span class="id" title="var">Quantity</span> :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="var">r</span>, <span class="id" title="var">s</span> <span class="id" title="keyword">with</span><br/>
| <span class="id" title="var">Zero</span>, <span class="id" title="var">_</span>    =&gt; <span class="id" title="var">Some</span> <span class="id" title="var">Zero</span><br/>
| <span class="id" title="var">_</span>   , <span class="id" title="var">Zero</span> =&gt; <span class="id" title="var">None</span><br/>
| <span class="id" title="var">Any</span> , <span class="id" title="var">r</span>    =&gt; <span class="id" title="var">Some</span> (<span class="id" title="var">complement</span> <span class="id" title="var">r</span>)<br/>
| <span class="id" title="var">_</span>   , <span class="id" title="var">_</span>    =&gt; <span class="id" title="keyword">if</span> <span class="id" title="var">decide</span> (<span class="id" title="var">Subusage</span> <span class="id" title="var">s</span> <span class="id" title="var">r</span>) <span class="id" title="keyword">then</span> <span class="id" title="var">Some</span> <span class="id" title="var">One</span> <span class="id" title="keyword">else</span> <span class="id" title="var">Some</span> <span class="id" title="var">r</span><br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">div'_spec</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> : <span class="id" title="var">Quantity</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">div'</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> = <span class="id" title="var">div</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">intros</span> [] []; <span class="id" title="var">cbn</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
We can also make the definition more explicit. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">div''</span> (<span class="id" title="var">r</span> <span class="id" title="var">s</span> : <span class="id" title="var">Quantity</span>) : <span class="id" title="var">option</span> <span class="id" title="var">Quantity</span> :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="var">r</span>, <span class="id" title="var">s</span> <span class="id" title="keyword">with</span><br/>
| <span class="id" title="var">Zero</span>, <span class="id" title="var">_</span>    =&gt; <span class="id" title="var">Some</span> <span class="id" title="var">Zero</span><br/>
| <span class="id" title="var">_</span>   , <span class="id" title="var">Zero</span> =&gt; <span class="id" title="var">None</span><br/>
| <span class="id" title="var">Any</span> , <span class="id" title="var">r</span>    =&gt; <span class="id" title="var">Some</span> (<span class="id" title="var">complement</span> <span class="id" title="var">r</span>)<br/>
| <span class="id" title="var">One</span> , <span class="id" title="var">_</span>    =&gt; <span class="id" title="var">Some</span> <span class="id" title="var">One</span><br/>
| <span class="id" title="var">Few</span> , <span class="id" title="var">Any</span>  =&gt; <span class="id" title="var">Some</span> <span class="id" title="var">One</span><br/>
| <span class="id" title="var">Few</span> , <span class="id" title="var">Few</span>  =&gt; <span class="id" title="var">Some</span> <span class="id" title="var">One</span><br/>
| <span class="id" title="var">Many</span>, <span class="id" title="var">Any</span>  =&gt; <span class="id" title="var">Some</span> <span class="id" title="var">One</span><br/>
| <span class="id" title="var">Many</span>, <span class="id" title="var">Many</span> =&gt; <span class="id" title="var">Some</span> <span class="id" title="var">One</span><br/>
| <span class="id" title="var">_</span>   , <span class="id" title="var">_</span>    =&gt; <span class="id" title="var">Some</span> <span class="id" title="var">r</span><br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">div''_spec</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> : <span class="id" title="var">Quantity</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">div''</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> = <span class="id" title="var">div</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">intros</span> [] []; <span class="id" title="var">cbn</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab1237"></a><h1 class="section">Miscellanea</h1>

<div class="paragraph"> </div>

<a id="lab1238"></a><h2 class="section">Arithmetic order</h2>


<div class="paragraph"> </div>

  <span class="inlinecode"><span class="id" title="var">ArithmeticOrder</span></span> is a decidable total order that orders quantities
  by how big (in some sense) they are.

<div class="paragraph"> </div>

  We define it explicitly as: <code>Zero &lt;= One &lt;= Few &lt;= Many &lt;= Any</code>.

<div class="paragraph"> </div>

  As we can see, it is very similar to the subtraction order, but this
  time <span class="inlinecode"><span class="id" title="var">Any</span></span> is the greatest element, strictly greater than <span class="inlinecode"><span class="id" title="var">Many</span></span>.

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">ArithmeticOrder</span> : <span class="id" title="var">Quantity</span> -&gt; <span class="id" title="var">Quantity</span> -&gt; <span class="id" title="keyword">Prop</span> :=<br/>
| <span class="id" title="var">ArithmeticOrder_refl</span>     : <span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> : <span class="id" title="var">Quantity</span>, <span class="id" title="var">ArithmeticOrder</span> <span class="id" title="var">r</span> <span class="id" title="var">r</span><br/>
| <span class="id" title="var">ArithmeticOrder_Zero_l</span>   : <span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> : <span class="id" title="var">Quantity</span>, <span class="id" title="var">ArithmeticOrder</span> <span class="id" title="var">Zero</span> <span class="id" title="var">r</span><br/>
| <span class="id" title="var">ArithmeticOrder_Any_r</span>    : <span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> : <span class="id" title="var">Quantity</span>, <span class="id" title="var">ArithmeticOrder</span> <span class="id" title="var">r</span> <span class="id" title="var">Any</span><br/>
| <span class="id" title="var">ArithmeticOrder_One_Few</span>  : <span class="id" title="var">ArithmeticOrder</span> <span class="id" title="var">One</span> <span class="id" title="var">Few</span><br/>
| <span class="id" title="var">ArithmeticOrder_One_Many</span> : <span class="id" title="var">ArithmeticOrder</span> <span class="id" title="var">One</span> <span class="id" title="var">Many</span><br/>
| <span class="id" title="var">ArithmeticOrder_Few_Many</span> : <span class="id" title="var">ArithmeticOrder</span> <span class="id" title="var">Few</span> <span class="id" title="var">Many</span>.<br/>

<br/>
#[<span class="id" title="var">export</span>] <span class="id" title="keyword">Hint</span> <span class="id" title="keyword">Constructors</span> <span class="id" title="var">ArithmeticOrder</span> : <span class="id" title="var">core</span>.<br/>

<br/>
#[<span class="id" title="var">export</span>] <span class="id" title="keyword">Instance</span> <span class="id" title="var">PreOrder_ArithmeticOrder</span> :<br/>
&nbsp;&nbsp;<span class="id" title="var">PreOrder</span> <span class="id" title="var">ArithmeticOrder</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">split</span>; <span class="id" title="tactic">red</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">now</span> <span class="id" title="tactic">do</span> 2 <span class="id" title="tactic">inversion</span> 1; <span class="id" title="tactic">subst</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
#[<span class="id" title="var">export</span>] <span class="id" title="keyword">Instance</span> <span class="id" title="var">Antisymmetric_ArithmeticOrder</span> :<br/>
&nbsp;&nbsp;<span class="id" title="var">Antisymmetric</span> <span class="id" title="var">_</span> <span class="id" title="var">eq</span> <span class="id" title="var">ArithmeticOrder</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">do</span> 2 <span class="id" title="tactic">inversion</span> 1; <span class="id" title="tactic">subst</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">Total_ArithmeticOrder</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> : <span class="id" title="var">Quantity</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">ArithmeticOrder</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> \/ <span class="id" title="var">ArithmeticOrder</span> <span class="id" title="var">s</span> <span class="id" title="var">r</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">intros</span> [] []; <span class="id" title="var">cbn</span>; <span class="id" title="tactic">firstorder</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
#[<span class="id" title="tactic">refine</span>, <span class="id" title="var">export</span>] <span class="id" title="keyword">Instance</span> <span class="id" title="var">Decidable_ArithmeticOrder</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> : <span class="id" title="var">Quantity</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Decidable</span> (<span class="id" title="var">ArithmeticOrder</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span>) :=<br/>
{<br/>
&nbsp;&nbsp;<span class="id" title="var">Decidable_witness</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">r</span>, <span class="id" title="var">s</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Zero</span>, <span class="id" title="var">_</span>    =&gt; <span class="id" title="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span>   , <span class="id" title="var">Any</span>  =&gt; <span class="id" title="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">One</span> , <span class="id" title="var">Few</span>  =&gt; <span class="id" title="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">One</span> , <span class="id" title="var">Many</span> =&gt; <span class="id" title="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Few</span> , <span class="id" title="var">Many</span> =&gt; <span class="id" title="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span>   , <span class="id" title="var">_</span>    =&gt; <span class="id" title="var">decide</span> (<span class="id" title="var">r</span> = <span class="id" title="var">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>;<br/>
}.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">destruct</span> <span class="id" title="var">r</span>, <span class="id" title="var">s</span>; <span class="id" title="var">cbn</span>.<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" title="var">ArithmeticOrder</span></span> embeds in <span class="inlinecode"><span class="id" title="var">SubtractionOrder</span></span>. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">SubtractionOrder_ArithmeticOrder</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> : <span class="id" title="var">Quantity</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">ArithmeticOrder</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span> -&gt; <span class="id" title="var">SubtractionOrder</span> <span class="id" title="var">r</span> <span class="id" title="var">s</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">inversion</span> 1.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
