\documentclass{beamer}
\usepackage[utf8]{inputenc}
\usepackage{babel}
\usepackage{xcolor}
\usepackage{Commands}

\usetheme{Darmstadt}

\title{T-Axi (declarative)}
\author
{
  Wojciech Ko≈Çowski\\
  \and
  Mateusz Pyzik\\
}
\date{}

\begin{document}

\frame{\titlepage}

\section{Quantities}

\begin{frame}{TODO}

\begin{itemize}
  \item Kinding.
  \item Polymorphism.
  \item Higher-order quantification.
  \item Totality checker.
  \item Computation.
  \item Inductives and records.
  \item Algorithmic system.
  \item Distinguish partial terms.
\end{itemize}

\end{frame}

\begin{frame}{Quantities}

Quantities: \\
$r ::= \Zero \pipe \One \pipe \Few \pipe \Many \pipe \Any$

\vspace{1em}

\begin{itemize}
  \item $\Zero$ means a resource has been used up and is no longer available.
  \item $\One$ means a resource must be used exactly once.
  \item $\Few$ (pronounced ``few'') means a resource must be used at most once.
  \item $\Many$ (pronounced ``many'') means a resource must be used at least once.
  \item $\Any$ (pronounced ``any'') means no restrictions on usage.
\end{itemize}

\vspace{1em}

$\Any$ is the default quantity, so when there's nothing to indicate quantity, it means it's $\Any$.

\end{frame}

\begin{frame}{Subusage ordering}

$\subusage{r_1}{r_2}$ means that a resource with quantity $r_1$ may be used when quantity $r_2$ is expected. This ordering is called sub-usaging. The definition below is just the skeleton, the full ordering is the reflexive-transitive closure of it.

\begin{center}
  $\subusage{\Any}{\Few}$ \\
  $\subusage{\Any}{\Many}$ \\
  $\subusage{\Many}{\One}$ \\
  $\subusage{\Few}{\One}$ \\
  $\subusage{\Few}{\Zero}$
\end{center}

\vspace{2em}

We will denote the greatest lower bound in this order with $\glbqty{r_1}{r_2}$ and the least upper bound (if it exists) with $\lubqty{r_1}{r_2}$.

\end{frame}

\begin{frame}{Addition of quantities}

When we have two quantities of the same resource, we can sum the quantities.

\vspace{2em}

\begin{center}
  $\addqty{\Zero}{r} = r$ \\
  $\addqty{r}{\Zero} = r$ \\
  $\addqty{\Few}{\Few} = \Any$ \\
  $\addqty{\Few}{\Any} = \Any$ \\
  $\addqty{\Any}{\Few} = \Any$ \\
  $\addqty{\Any}{\Any} = \Any$ \\
  $\addqty{\_}{\_} = \Many$
\end{center}

\end{frame}

\begin{frame}{Multiplication of quantities}

When we have a quantity $r_1$ of resource $A$ that contains quantitty $r_2$ of resource $B$, then we in fact have quantity $\mulqty{r_1}{r_2}$ of resource $B$.

\vspace{2em}

\begin{center}
  $\mulqty{\Zero}{r} = \Zero$ \\
  $\mulqty{r}{\Zero} = \Zero$ \\
  $\mulqty{\One}{r} = r$ \\
  $\mulqty{r}{\One} = r$ \\
  $\mulqty{\Few}{\Few} = \Few$ \\
  $\mulqty{\Many}{\Many} = \Many$ \\
  $\mulqty{\_}{\_} = \Any$
\end{center}

\end{frame}

\begin{frame}{The algebra of quantities}

Quantities $\qty$ form a positive ordered commutative semiring with no zero divisors, i.e.:

\begin{itemize}
  \item $(\qty, \addqty{}{}, \Zero)$ is a commutative monoid.
  \item $(\qty, \mulqty{}{}, \One)$ is a commutative monoid.
  \item $\Zero$ annihilates multiplication.
  \item Multiplication distributes over addition.
  \item Addition and multiplication preserve the subusage ordering in both arguments.
  \item If $\addqty{r_1}{r_2} = \Zero$, then $r_1 = \Zero$ and $r_2 = \Zero$.
  \item If $\mulqty{r_1}{r_2} = \Zero$, then $r_1 = \Zero$ or $r_2 = \Zero$.
\end{itemize}

\end{frame}

\section{Syntax}

\begin{frame}{Types}

Types: \\
$A, B ::= \Fun[r]{A}{B} \pipe \Box[r]{A} \pipe \Prod{A}{B} \pipe \Sum{A}{B} \pipe \Unit \pipe \Empty$

\end{frame}

\begin{frame}{Terms}

Terms: \\
$e ::=$ \\
\qquad $x \pipe \fun[r]{x}[A]{e} \pipe \app{e_1}{e_2} \pipe$ \\
\qquad $\boxintro[r]{e} \pipe \boxelim{x}[A]{e_1}{e_2}$ \\
\qquad $\pair{e_1}{e_2} \pipe \letpair{x}{y}{e_1}{e_2} \pipe$ \\
\qquad $\inl[A]{e} \pipe \inr[A]{e} \pipe \case{e}{e_1}{e_2} \pipe$ \\
\qquad $\unit \pipe \unitelim[A]{e_1}{e_2} \pipe$ \\
\qquad $\emptyelim[A]{e} \pipe$ \\
\qquad $\letin[r]{x}[A]{e_1}{e_2} \pipe$ \\
\qquad $\letnoncomp{x}[A]{e_1}{e_2} \pipe$ \\
\qquad $\choose[A]{p} \pipe \choosewitnessp{x}{h}{p}{e}$

\vspace{2em}

$\choose[A]{p}$ and $\choosewitnessp{x}{h}{p}{e}$ are noncomputable terms, whereas all others are computable.

\end{frame}

\begin{frame}{Propositions}

Propositions: \\
$P, Q ::=$ \\
\qquad $\True \pipe \False \pipe \Impl{P}{Q} \pipe \And{P}{Q} \pipe \Or{P}{Q} \pipe$ \\
\qquad $\All{x}[A]{P} \pipe \Ex{x}[A]{P} \pipe$ \\
\qquad $\Eq[A]{e_1}{e_2}$

\vspace{2em}

Notations: \\
$\Not{P}$ stands for $\Impl{P}{\False}$ \\
$\Iff{P}{Q}$ stands for $\And{(\Impl{P}{Q})}{(\Impl{Q}{P})}$

\end{frame}

\begin{frame}{Proofterms}

Proofterms ($P, Q$ are propositions, $e$ are terms, $h$ are variables): \\
$p, q ::=$ \\
\qquad $h \pipe \assumption \pipe \trueintro \pipe \falseelim{p}$ \\
\qquad $\implintro{h}[P]{q} \pipe \implelim{p_1}{p_2} \pipe$ \\
\qquad $\andintro{p_1}{p_2} \pipe \andeliml{p} \pipe \andelimr{p} \pipe$ \\
\qquad $\orintrol{p} \pipe \orintror{p} \pipe \orelim{p_1}{p_2}{p_3} \pipe$ \\
\qquad $\lemma{h}{P}{p}{q} \pipe \proofannot{P}{p} \pipe$ \\
\qquad $\suffices{P}{q}{p} \pipe$ \\
\qquad $\allintro{x}[A]{e} \pipe \allelim{p}{e} \pipe$ \\
\qquad $\exintro{e}{p} \pipe \exelim{x}{h}{p_1}{p_2} \pipe$ \\
\qquad $\refl[e] \pipe \rewrite{p_1}{p_2} \pipe \funext{x}[A]{p}$ \\
\qquad $\bycontradiction{h}[\Not{P}]{q} \pipe$ \\
\qquad $\choosespec{p} \pipe \choosewitnessl{x}{h}{p}{q}$
\end{frame}

\begin{frame}{Contexts}

Contexts: \\
$\Gamma ::= \emptyctx \pipe \extend{\Gamma}[r]{x}{A} \pipe \extend{\Gamma}[r]{x}{A}[e] \pipe \assume{\Gamma}{h}{P}$ % \pipe \extendtype{\Gamma}{\alpha}$

\end{frame}

\begin{frame}{Judgements}

Well-formed context judgement: $\ctx[i]{\Gamma}$, where $i$ is either $\computable$ or $\noncomputable$.

\vspace{2em}

Well-formed type judgement: $\type[\Gamma]{A}$ \\
Type conversion judgement: $\typeconv[\Gamma]{A}{B}$

\vspace{2em}

Typing judgement: $\typing[\Gamma][i]{e}{A}$, where $i$ is either $\computable$ or $\noncomputable$ \\
Conversion judgement: $\termconv[\Gamma]{e_1}{e_2}{A}$

\vspace{2em}

Well-formed proposition judgement: $\prop[\Gamma]{P}$ \\
Proposition conversion judgement: $\propconv[\Gamma]{P}{Q}$

\vspace{2em}

Proof judgement: $\proves[\Gamma]{p}{P}$

\end{frame}

\begin{frame}{Sanity checks}

We'll set up the system so that:

\begin{itemize}
  \item If $\termconv[\Gamma]{e_1}{e_2}{A}$, then $\typing[\Gamma][\noncomputable]{e_1}{A}$ and $\typing[\Gamma][\noncomputable]{e_2}{A}$.
  \item If $\typing[\Gamma][i]{e}{A}$, then $\type[\cartesianize{\Gamma}]{A}$ and $\ctx[i]{\Gamma}$.
  \item If $\typeconv[\Gamma]{A}{B}$, then $\type[\Gamma]{A}$ and $\type[\Gamma]{B}$.
  \item If $\type[\Gamma]{A}$, then $\ctx[\noncomputable]{\Gamma}$.
  \item If $\proves[\Gamma]{p}{P}$, then $\prop[\Gamma]{P}$.
  \item If $\propconv[\Gamma]{P}{Q}$, then $\prop[\Gamma]{P}$ and $\prop[\Gamma]{Q}$.
  \item If $\prop[\Gamma]{P}$, then $\ctx[\noncomputable]{\Gamma}$.
  \item If $\ctx[\noncomputable]{\Gamma}$, then $\ctx[\computable]{\Gamma}$.
\end{itemize}

\end{frame}

\section{Contexts}

\begin{frame}{Operations on contexts}

Operations on contexts: \\
$\subctx{\Gamma_1}{\Gamma_2}$ -- context subusaging \\
$\addctx{\Gamma_1}{\Gamma_2}$ -- context addition \\
$\scalectx{r}{\Gamma}$ -- context scaling \\
$\cartesianize{\Gamma}$ -- cartesianization \\
$\varctx{\Gamma}{x}$ -- spotlight $x$

\end{frame}

\begin{frame}{Context subusaging}

\begin{center}
  $\infrule{}{\subctx{\emptyctx}{\emptyctx}}$

  \vspace{1em}

  $\infrule{\subctx{\Gamma_1}{\Gamma_2} \quad \subusage{r_1}{r_2}}{\subctx{\extend{\Gamma_1}[r_1]{x}{A}}{\extend{\Gamma_2}[r_2]{x}{A}}}$

  \vspace{2em}

  $\infrule{\subctx{\Gamma_1}{\Gamma_2} \quad \subusage{r_1}{r_2}}{\subctx{\extend{\Gamma_1}[r_1]{x}{A}[e]}{\extend{\Gamma_2}[r_2]{x}{A}[e]}}$

  \vspace{2em}

  $\infrule{\subctx{\Gamma_1}{\Gamma_2}}{\subctx{\assume{\Gamma_1}{h}{P}}{\assume{\Gamma_2}{h}{P}}}$
\end{center}

\end{frame}

\begin{frame}{Context addition}

\begin{center}
  $\addctx{\emptyctx}{\emptyctx} = \emptyctx$ \\
  $\addctx{(\extend{\Gamma_1}[r_1]{x}{A})}{(\extend{\Gamma_2}[r_2]{x}{A})} = \extend{(\addctx{\Gamma_1}{\Gamma_2})}[(\addqty{r_1}{r_2})]{x}{A}$ \\
  $\addctx{(\extend{\Gamma_1}[r_1]{x}{A}[e])}{(\extend{\Gamma_2}[r_2]{x}{A}[e])} = \extend{(\addctx{\Gamma_1}{\Gamma_2})}[(\addqty{r_1}{r_2})]{x}{A}[e]$ \\
  $\addctx{(\assume{\Gamma_1}{p}{P})}{(\assume{\Gamma_2}{h}{P})} = \assume{(\addctx{\Gamma_1}{\Gamma_2})}{h}{P}$
\end{center}

\end{frame}

\begin{frame}{Context scaling}

\begin{center}
  $\scalectx{s}{\emptyctx} = \emptyctx$ \\
  $\scalectx{s}{(\extend{\Gamma}[r]{x}{A})} = \extend{\scalectx{s}{\Gamma}}[(\mulqty{s}{r})]{x}{A}$ \\
  $\scalectx{s}{(\extend{\Gamma}[r]{x}{A}[e])} = \extend{\scalectx{s}{\Gamma}}[(\mulqty{s}{r})]{x}{A}[e]$ \\
  $\scalectx{s}{(\assume{\Gamma}{h}{P})} = \assume{\scalectx{s}{\Gamma}}{h}{P}$ \\
\end{center}

\end{frame}

\begin{frame}{Spotlight}

\begin{center}
  $\varctx{\emptyctx}{x} = \mathbf{undefined}$ \\
  $\varctx{\extend{\Gamma}[r]{x}{A}}{x} = \extend{\scalectx{\Zero}{\Gamma}}[\One]{x}{A}$ \\
  $\varctx{\extend{\Gamma}[r]{y}{A}}{x} = \extend{\varctx{\Gamma}{x}}[\Zero]{y}{A}$ \\
  $\varctx{\extend{\Gamma}[r]{x}{A}[e]}{x} = \extend{\scalectx{\Zero}{\Gamma}}[\One]{x}{A}[e]$ \\
  $\varctx{\extend{\Gamma}[r]{y}{A}[e]}{x} = \extend{\varctx{\Gamma}{x}}[\Zero]{y}{A}[e]$ \\
  $\varctx{\assume{\Gamma}{h}{P}}{x} = \assume{\varctx{\Gamma}{x}}{h}{P}$
\end{center}

\end{frame}

\begin{frame}{Cartesianization}

Cartesianization turns a context into a context with the same shape but unlimited resources.

\begin{center}
  $\cartesianize{\emptyctx} = \emptyctx$ \\
  $\cartesianize{\extend{\Gamma}[r]{x}{A}} = \extend{\cartesianize{\Gamma}}{x}{A}$ \\
  $\cartesianize{\extend{\Gamma}[r]{x}{A}[e]} = \extend{\cartesianize{\Gamma}}{x}{A}[e]$ \\
  $\cartesianize{\assume{\Gamma}{h}{P}} = \assume{\cartesianize{\Gamma}}{h}{P}$
\end{center}

\end{frame}

\begin{frame}{Well-formed contexts}

\begin{center}
  $\infrule{}{\ctx[\computable]{\emptyctx}}$

  \vspace{2em}

  $\infrule{\ctx[\computable]{\Gamma} \quad \type[\cartesianize{\Gamma}]{A} \quad \sidecond{x \notin \Gamma}}{\ctx[\computable]{\extend{\Gamma}[r]{x}{A}}}$

  \vspace{2em}

  $\infrule{\ctx[\computable]{\Gamma} \quad \typing[\cartesianize{\Gamma}][\noncomputable]{e}{A} \quad \sidecond{x \notin \Gamma}}{\ctx[\computable]{\extend{\Gamma}[r]{x}{A}[e]}}$

  \vspace{2em}

  $\infrule{\ctx[\computable]{\Gamma} \quad \prop[\cartesianize{\Gamma}]{P} \quad \sidecond{h \notin \Gamma}}{\ctx[\computable]{\assume{\Gamma}{h}{P}}}$

  \vspace{2em}

  $\infrule{\ctx[\computable]{\Gamma} \quad \sidecond{\Gamma = \cartesianize{\Gamma}}}{\ctx[\noncomputable]{\Gamma}}$
\end{center}

\end{frame}

\section{Programming}

\begin{frame}{Well-formed types}

\begin{center}
  $\infrule{\ctx[\noncomputable]{\Gamma}}{\type[\Gamma]{\Unit}}$ \quad
  $\infrule{\ctx[\noncomputable]{\Gamma}}{\type[\Gamma]{\Empty}}$

  \vspace{2em}

  $\infrule{\type{A} \quad \type{B}}{\type{\Fun[r]{A}{B}}}$ \quad
  $\infrule{\type{A}}{\type{\Box[r]{A}}}$

  \vspace{2em}

  $\infrule{\type{A} \quad \type{B}}{\type{\Prod{A}{B}}}$ \quad
  $\infrule{\type{A} \quad \type{B}}{\type{\Sum{A}{B}}}$

\end{center}

\end{frame}

\begin{frame}{The inherent quantity of a type}

\begin{center}
  $\typeqty{\Unit} = \Any$ \\
  $\typeqty{\Empty} = \Any$ \\
  $\typeqty{\Box[\Zero]{A}} = \Any$ \\
  $\typeqty{\Box[r]{A}} = \mulqty{r}{\typeqty{A}}$ \\
  $\typeqty{\Prod{A}{B}} = \lubqty{\typeqty{A}}{\typeqty{B}}$ \\
  $\typeqty{\Sum{A}{B}} = \lubqty{\typeqty{A}}{\typeqty{B}}$ \\
  $\typeqty{\Fun[r]{A}{B}} = \One$
\end{center}

\end{frame}

\begin{frame}{Total quantity added to context}

\begin{center}
  $\totalqty{r}{A}[\noncomputable] = \Any$ \\
  $\totalqty{r}{A}[\computable] = \mulqty{r}{\typeqty{A}}$
\end{center}

\end{frame}

\begin{frame}{Using variables}

\begin{center}
  $\infrule{\ctx{\Gamma} \quad (x : A) \in \Gamma \quad \subctx{\Gamma}{\varctx{\Gamma}{x}}}{\typing[\Gamma]{x}{A}}$
\end{center}

\end{frame}

\begin{frame}{Functions}

\begin{center}
  $\infrule{\typing[\extend{\Gamma}[\totalqty{r}{A}]{x}{A}]{e}{B}}{\typing[\Gamma]{\fun[r]{x}[A]{e}}{\Fun[r]{A}{B}}}$

  \vspace{2em}

  $\infrule{\subctx{\Gamma}{\addctx{\Gamma_1}{\scalectx{r}{\Gamma_2}}} \quad \typing[\Gamma_1]{e_1}{\Fun[r]{A}{B}} \quad \typing[\Gamma_2]{e_2}{A}}{\typing[\Gamma]{\app{e_1}{e_2}}{B}}$
\end{center}

\end{frame}

\begin{frame}{Box}

\begin{center}
  $\infrule{\subctx{\Gamma}{\scalectx{r}{\Gamma'}} \quad \typing[\Gamma']{e}{A}}{\typing[\Gamma]{\boxintro[r]{e}}{\Box[r]{A}}}$

  \vspace{2em}

  $\infrule{\decomposectx{\Gamma}{\Gamma_1}{\Gamma_2} \quad \typing[\Gamma_1]{e_1}{\Box[r]{A}} \quad \typing[\extend{\Gamma_2}[\totalqty{r}{A}]{x}{A}]{e_2}{B}}{\typing[\Gamma]{\boxelim{x}[A]{e_1}{e_2}}{B}}$
\end{center}

\end{frame}

\begin{frame}{Empty}

\begin{center}
  $\infrule{\type[\cartesianize{\Gamma}]{A} \quad \typing[\Gamma]{e}{\Empty}}{\typing[\Gamma]{\emptyelim[A]{e}}{A}}$
\end{center}

\end{frame}

\begin{frame}{Unit}

\begin{center}
  $\infrule{\ctx{\Gamma} \quad \subctx{\Gamma}{\scalectx{\Zero}{\Gamma}}}{\typing[\Gamma]{\unit}{\Unit}}$

  \vspace{2em}

  $\infrule{\decomposectx{\Gamma}{\Gamma_1}{\Gamma_2} \quad \typing[\Gamma_1]{e_1}{\Unit} \quad \typing[\Gamma_2]{e_2}{A}}{\typing[\Gamma]{\unitelim[A]{e_1}{e_2}}{A}}$
\end{center}

\end{frame}

\begin{frame}{Products}

\begin{center}
  $\infrule{\decomposectx{\Gamma}{\Gamma_1}{\Gamma_2} \quad \typing[\Gamma_1]{a}{A} \quad \typing[\Gamma_2]{b}{B}}{\typing[\Gamma]{\pair{a}{b}}{\Prod{A}{B}}}$

  \vspace{2em}

  $\infrule{\decomposectx{\Gamma}{\Gamma_1}{\Gamma_2} \quad \typing[\Gamma_1]{e_1}{\Prod{A}{B}} \quad \typing[\extend{\extend{\Gamma_2}[\totalqty{\One}{A}]{x}{A}}[\totalqty{\One}{B}]{y}{B}]{e_2}{C}}{\typing[\Gamma]{\letpair{x}{y}{e_1}{e_2}}{C}}$
\end{center}

\end{frame}

\begin{frame}{Sums}

\begin{center}
  $\infrule{\typing[\Gamma]{e}{A} \quad \type[\cartesianize{\Gamma}]{B}}{\typing[\Gamma]{\inl[B]{e}}{\Sum{A}{B}}}$ \quad
  $\infrule{\type[\cartesianize{\Gamma}]{A} \quad \typing[\Gamma]{e}{B}}{\typing[\Gamma]{\inr[A]{e}}{\Sum{A}{B}}}$

  \vspace{2em}

  $\infrule{\decomposectx{\Gamma}{\Gamma_1}{\Gamma_2} \quad \typing[\Gamma_1]{e}{\Sum{A}{B}} \quad \typing[\Gamma_2]{f}{\Fun[\One]{A}{C}} \quad \typing[\Gamma_2]{g}{\Fun[\One]{B}{C}}}{\typing[\Gamma]{\case{e}{f}{g}}{C}}$
\end{center}

\vspace{2em}

Q: Do we want first-order representation of the branches? Probably yes.

\end{frame}

\begin{frame}{Let}

\begin{center}
  $\infrule{\subctx{\Gamma}{\addctx{\scalectx{r}{\Gamma_1}}{\Gamma_2}} \quad \typing[\Gamma_1]{e_1}{A} \quad \typing[\extend{\Gamma_2}[\totalqty{r}{A}]{x}{A}[e_1]]{e_2}{B}}{\typing[\Gamma]{\letin[r]{x}[A]{e_1}{e_2}}{B}}$
\end{center}

\end{frame}

\section{Logic}

\begin{frame}{Well-formed propositions}

\begin{center}
  $\infrule{\ctx[\noncomputable]{\Gamma}}{\prop[\Gamma]{\True}}$ \quad
  $\infrule{\ctx[\noncomputable]{\Gamma}}{\prop[\Gamma]{\False}}$

  \vspace{1em}

  $\infrule{\prop{P} \quad \prop{Q}}{\prop{\Impl{P}{Q}}}$

  \vspace{1em}

  $\infrule{\prop{P} \quad \prop{Q}}{\prop{\And{P}{Q}}}$ \quad
  $\infrule{\prop{P} \quad \prop{Q}}{\prop{\Or{P}{Q}}}$

  \vspace{1em}

  $\infrule{\type{A} \quad \prop[\extend{\Gamma}{x}{A}]{P}}{\prop{\All{x}[A]{P}}}$

  \vspace{1em}

  $\infrule{\type{A} \quad \prop[\extend{\Gamma}{x}{A}]{P}}{\prop{\Ex{x}[A]{P}}}$

  \vspace{1em}

  $\infrule{\type{A} \quad \typing[\Gamma][\noncomputable]{e_1}{A} \quad \typing[\Gamma][\noncomputable]{e_2}{A}}{\prop[\Gamma]{\Eq[A]{e_1}{e_2}}}$

\end{center}

\end{frame}

\begin{frame}{Substitution}

The notation is $\subst{P}{x}{e}$ for substitution in propositions.

\end{frame}

\begin{frame}{Assumptions and implication}

\begin{center}

  $\infrule{\ctx[\noncomputable]{\Gamma} \quad \sidecond{(h : P) \in \Gamma}}{\proves[\Gamma]{h}{P}}$ \quad
  $\infrule{\ctx[\noncomputable]{\Gamma} \quad \sidecond{(h : P) \in \Gamma}}{\proves[\Gamma]{\assumption}{P}}$

  \vspace{2em}

  $\infrule{\proves[\assume{\Gamma}{h}{P}]{q}{Q}}{\proves[\Gamma]{\implintro{h}[P]{q}}{\Impl{P}{Q}}}$

  \vspace{2em}

  $\infrule{\proves{q}{\Impl{P}{Q}} \quad \proves{p}{P}}{\proves{\implelim{q}{p}}{Q}}$
\end{center}

\end{frame}

\begin{frame}{Propositional logic}

\begin{center}
  $\infrule{\ctx[\noncomputable]{\Gamma}}{\proves[\Gamma]{\trueintro}{\True}}$ \quad
  $\infrule{\prop[\Gamma]{Q} \quad \proves[\Gamma]{p}{\False}}{\proves[\Gamma]{\falseelim{p}}{Q}}$

  \vspace{2em}

  $\infrule{\proves[\Gamma]{p}{P} \quad \proves[\Gamma]{q}{Q}}{\proves[\Gamma]{\andintro{p}{q}}{\And{P}{Q}}}$

  \vspace{1em}

  $\infrule{\proves[\Gamma]{pq}{\And{P}{Q}}}{\proves[\Gamma]{\andeliml{pq}}{P}}$ \quad
  $\infrule{\proves[\Gamma]{pq}{\And{P}{Q}}}{\proves[\Gamma]{\andelimr{pq}}{Q}}$

  \vspace{2em}

  $\infrule{\proves[\Gamma]{p}{P} \quad \prop[\Gamma]{Q}}{\proves[\Gamma]{\orintrol{p}}{\Or{P}{Q}}}$ \quad
  $\infrule{\prop[\Gamma]{P} \quad \proves[\Gamma]{q}{Q}}{\proves[\Gamma]{\orintror{q}}{\Or{P}{Q}}}$

  \vspace{1em}

  $\infrule{\proves[\Gamma]{pq}{\Or{P}{Q}} \quad \proves[\Gamma]{r_1}{\Impl{P}{R}} \quad \proves[\Gamma]{r_2}{\Impl{Q}{R}}}{\proves[\Gamma]{\orelim{pq}{r_1}{r_2}}{R}}$
\end{center}

\end{frame}

\begin{frame}{Utilities}

\begin{center}
  $\infrule{\proves[\Gamma]{p}{P} \quad \proves[\assume{\Gamma}{h}{P}]{q}{Q}}{\proves[\Gamma]{\lemma{h}{P}{p}{q}}{Q}}$

  \vspace{2em}

  $\infrule{\proves[\Gamma]{p}{P}}{\proves[\Gamma]{\proofannot{P}{p}}{P}}$

  \vspace{2em}

  $\infrule{\proves[\Gamma]{pq}{\Impl{P}{Q}} \quad \proves[\Gamma]{p}{P}}{\proves[\Gamma]{\suffices{P}{pq}{p}}{Q}}$

\end{center}

\end{frame}

\begin{frame}{Quantifiers}

\begin{center}
  $\infrule{\proves[\extend{\Gamma}{x}{A}]{p}{P}}{\proves[\Gamma]{\allintro{x}[A]{p}}{\All{x}[A]{P}}}$

  \vspace{1em}

  $\infrule{\proves{p}{\All{x}[A]{P}} \quad \typing[\Gamma][\noncomputable]{e}{A}}{\proves{\allelim{p}{e}}{\subst{P}{x}{e}}}$

  \vspace{2em}

  $\infrule{\typing[\Gamma][\noncomputable]{e}{A} \quad \prop[\extend{\Gamma}{x}{A}]{P} \quad \proves{p}{\subst{P}{x}{e}}}{\proves{\exintro{e}{p}}{\Ex{x}[A]{P}}}$

  \vspace{1em}

  $\infrule{\proves[\Gamma]{p}{\Ex{x}[A]{P}} \quad \prop{Q} \quad \proves[\assume{\extend{\Gamma}{x}{A}}{h}{P}]{q}{Q}}{\proves[\Gamma]{\exelim{x}{h}{p}{q}}{Q}}$
\end{center}

\end{frame}

\begin{frame}{Equality}

\begin{center}
  $\infrule{\typing[\Gamma][\noncomputable]{e}{A}}{\proves[\Gamma]{\refl[e]}{\Eq[A]{e}{e}}}$

  \vspace{2em}

  $\infrule{\proves[\Gamma]{q}{\Eq[A]{e_1}{e_2}} \quad \prop[\extend{\Gamma}{x}{A}]{P} \quad \proves[\Gamma]{p}{\subst{P}{x}{e_2}}}{\proves[\Gamma]{\rewrite{q}{p}}{\subst{P}{x}{e_1}}}$

  \vspace{2em}

  $\infrule{\proves[\extend{\Gamma}{x}{A}]{p}{\Eq[B]{\app{f}{x}}{\app{g}{x}}}}{\proves[\Gamma]{\funext{x}[A]{p}}{\Eq[\Fun[r]{A}{B}]}{f}{g}}$
\end{center}

\end{frame}

\begin{frame}{Classical Logic}

\begin{center}
  $\infrule{\proves[\assume{\Gamma}{h}{\Not{P}}]{q}{\False}}{\proves[\Gamma]{\bycontradiction{h}[\Not{P}]{q}}{P}}$

  \vspace{2em}

  $\infrule{\proves[\cartesianize{\Gamma}]{p}{\Ex{x}[A]{P}}}{\typing[\Gamma][\noncomputable]{\choose{p}}{A}}$

  \vspace{1em}

  $\infrule{\proves{p}{\Ex{x}[A]{P}}}{\proves{\choosespec{p}}{\subst{P}{x}{\choose{p}}}}$

  \vspace{2em}

  $\infrule{\proves[\Gamma]{p}{\Ex{x}[A]{P}} \quad \prop{Q} \quad \proves[\assume{\extend{\Gamma}{x}{A}[\choose{p}]}{h}{P}]{q}{Q}}{\proves[\Gamma]{\choosewitnessl{x}{h}{p}{q}}{Q}}$

  \vspace{1em}

  $\infrule{\proves[\cartesianize{\Gamma}]{p}{\Ex{x}[A]{P}} \quad \type[\cartesianize{\Gamma}]{B} \quad \typing[\assume{\extend{\Gamma}{x}{A}[\choose{p}]}{h}{P}][\noncomputable]{e}{B}}{\typing[\Gamma][\noncomputable]{\choosewitnessp{x}{h}{p}{e}}{B}}$

\end{center}

\end{frame}

\section{Conversion}

\begin{frame}{Conversion rules}

\begin{center}
  $\infrule{\typing[\Gamma]{e}{A} \quad \typeconv[\cartesianize{\Gamma}]{A}{B}}{\typing[\Gamma]{e}{B}}$

  \vspace{2em}

  $\infrule{\termconv{e_1}{e_2}{A} \quad \typeconv{A}{B}}{\termconv{e_1}{e_2}{B}}$

  \vspace{2em}

  $\infrule{\proves[\Gamma]{p}{P} \quad \propconv[\Gamma]{P}{Q}}{\proves[\Gamma]{p}{Q}}$
\end{center}

\end{frame}

\begin{frame}{Type conversion}

\begin{center}
  $\infrule{\ctx[\noncomputable]{\Gamma}}{\typeconv{\Unit}{\Unit}}$ \quad
  $\infrule{\ctx[\noncomputable]{\Gamma}}{\typeconv{\Empty}{\Empty}}$

  \vspace{2em}

  $\infrule{\typeconv{A_1}{A_2} \quad \typeconv{B_1}{B_2}}{\typeconv{\Fun[r]{A_1}{B_1}}{\Fun[r]{A_2}{B_2}}}$

  \vspace{2em}

  $\infrule{\typeconv{A_1}{A_2}}{\typeconv{\Box[r]{A_1}}{\Box[r]{A_2}}}$

  \vspace{2em}

  $\infrule{\typeconv{A_1}{A_2} \quad \typeconv{B_1}{B_2}}{\typeconv{\Prod{A_1}{B_1}}{\Prod{A_2}{B_2}}}$

  \vspace{2em}

  $\infrule{\typeconv{A_1}{A_2} \quad \typeconv{B_1}{B_2}}{\typeconv{\Sum{A_1}{B_1}}{\Sum{A_2}{B_2}}}$
\end{center}

\end{frame}

\begin{frame}{Type conversion -- properties}

The rules above are the complete definition of type conversion. For now the context $\Gamma$ is not used, but soon it will. We don't need to take any closures -- type conversion already is an equivalence relation.

\begin{itemize}
  \item $\typeconv{A}{A}$
  \item If $\typeconv{A}{B}$ then $\typeconv{B}{A}$
  \item If $\typeconv{A}{B}$ and $\typeconv{B}{C}$ then $\typeconv{A}{C}$
\end{itemize}

\end{frame}

\begin{frame}{Proposition conversion}

\begin{center}
  $\infrule{\ctx[\noncomputable]{\Gamma}}{\propconv{\True}{\True}}$ \quad
  $\infrule{\ctx[\noncomputable]{\Gamma}}{\propconv{\False}{\False}}$

  \vspace{2em}

  $\infrule{\propconv{P_1}{P_2} \quad \propconv{Q_1}{Q_2}}{\propconv{\Impl{P_1}{Q_1}}{\Impl{P_2}{Q_2}}}$

  \vspace{2em}

  $\infrule{\propconv{P_1}{P_2} \quad \propconv{Q_1}{Q_2}}{\propconv{\And{P_1}{Q_1}}{\And{P_2}{Q_2}}}$

  \vspace{2em}

  $\infrule{\propconv{P_1}{P_2} \quad \propconv{Q_1}{Q_2}}{\propconv{\Or{P_1}{Q_1}}{\Or{P_2}{Q_2}}}$
\end{center}

\end{frame}

\begin{frame}{Proposition conversion}

\begin{center}
  $\infrule{\typeconv{A_1}{A_2} \quad \propconv[\extend{\Gamma}{x}{A_1}]{P_1}{P_2}}{\propconv{\All{x}[A_1]{P_1}}{\All{x}[A_2]{P_2}}}$

  \vspace{2em}

  $\infrule{\typeconv{A_1}{A_2} \quad \propconv[\extend{\Gamma}{x}{A_1}]{P_1}{P_2}}{\propconv{\Ex{x}[A_1]{P_1}}{\Ex{x}[A_2]{P_2}}}$

  \vspace{2em}

  $\infrule{\typeconv{A_1}{A_2} \quad \termconv{e_1}{e_2}{A_1} \quad \termconv{e_1'}{e_2'}{A_1}}{\propconv{\Eq[A_1]{e_1}{e_1'}}{\Eq[A_2]{e_2}{e_2'}}}$
\end{center}

\vspace{2em}

Note that we don't worry about $\alpha$-conversion and assume the variable is the same on both sides.

\end{frame}

\begin{frame}{Term conversion -- Empty}

\begin{center}
  $\infrule{\typing[\Gamma][\noncomputable]{e_1}{\Empty} \quad \typing[\Gamma][\noncomputable]{e_2}{\Empty}}{\termconv[\Gamma]{e_1}{e_2}{\Empty}}$

  \vspace{2em}

  $\infrule{\type[\Gamma]{A} \quad \termconv{e_1}{e_2}{\Empty}}{\termconv{\emptyelim{e_1}}{\emptyelim{e_2}}{A}}$
\end{center}

\end{frame}

\begin{frame}{Term conversion -- Unit}

\begin{center}
  $\infrule{\typing[\Gamma][\noncomputable]{a}{A}}{\termconv{\unitelim{\unit}{a}}{a}{A}}$

  \vspace{2em}

  $\infrule{\typing[\Gamma][\noncomputable]{u_1}{\Unit} \quad \typing[\Gamma][\noncomputable]{u_2}{\Unit}}{\termconv[\Gamma]{u_1}{u_2}{\Unit}}$

  \vspace{2em}

  $\infrule{\termconv{u_1}{u_2}{\Unit} \quad \termconv{a_1}{a_2}{A}}{\termconv{\unitelim{u_1}{a_1}}{\unitelim{u_2}{a_2}}{A}}$
\end{center}

\end{frame}

\begin{frame}{Term conversion -- functions}

\begin{center}
  $\infrule{\typing[\extend{\Gamma}{x}{A}][\noncomputable]{b}{B} \quad \typing[\Gamma][\noncomputable]{a}{A}}{\termconv{\app{(\fun[r]{x}[A]{b})}{a}}{\subst{b}{x}{a}}{B}}$

  \vspace{2em}

  $\infrule{\termconv[\extend{\Gamma}{x}{A}]{\app{f}{x}}{\app{g}{x}}{B}}{\termconv[\Gamma]{f}{g}{\Fun[r]{A}{B}}}$

  \vspace{2em}

  $\infrule{\termconv{f_1}{f_2}{\Fun[r]{A}{B}} \quad \termconv{a_1}{a_2}{A}}{\termconv{\app{f_1}{a_1}}{\app{f_2}{a_2}}{B}}$
\end{center}

\end{frame}

\begin{frame}{Term conversion -- box}

\begin{center}
  $\infrule{\typing[\Gamma][\noncomputable]{a}{A} \quad \typing[\extend{\Gamma}{x}{A}][\noncomputable]{b}{B}}{\termconv{\boxelim{x}[A]{\boxintro[r]{a}}{b}}{\subst{b}{x}{a}}{B}}$

  \vspace{2em}

  $\infrule{\termconv{a_1}{a_2}{A}}{\termconv{\boxintro{a_1}}{\boxintro{a_2}}{\Box[r]{A}}}$
  
  \vspace{2em}

  $\infrule{\termconv{a_1}{a_2}{\Box[r]{A}} \quad \termconv[\extend{\Gamma}{x}{A_1}]{b_1}{b_2}{B}}{\termconv{\boxelim{x}[A_1]{a_1}{b_1}}{\boxelim{x}[A_2]{a_2}{b_2}}{B}}$
\end{center}

\end{frame}

\begin{frame}{Term conversion -- product}

\begin{center}
  $\infrule{\typing[\Gamma][\noncomputable]{a}{A} \quad \typing[\Gamma][\noncomputable]{b}{B} \quad \typing[\extend{\extend{\Gamma}{x}{A}}{y}{B}][\noncomputable]{c}{C}}{\termconv{\letpair{x}{y}{\pair{a}{b}}{c}}{\subst{\subst{c}{x}{a}}{y}{b}}{C}}$

  \vspace{2em}

  $\infrule{\begin{array}{l} \termconv{\letpair{x}{y}{e_1}{x}}{\letpair{x}{y}{e_2}{x}}{A} \\ \termconv{\letpair{x}{y}{e_1}{y}}{\letpair{x}{y}{e_2}{y}}{B} \end{array}}{\termconv{e_1}{e_2}{\Prod{A}{B}}}$

  \vspace{2em}

  $\infrule{\termconv{a_1}{a_2}{A} \quad \termconv{b_1}{b_2}{B}}{\termconv{\pair{a_1}{b_1}}{\pair{a_2}{b_2}}{\Prod{A}{B}}}$

  \vspace{2em}

  $\infrule{\termconv{e_1}{e_2}{\Prod{A}{B}} \quad \termconv[\extend{\extend{\Gamma}{x}{A}}{y}{B}]{c_1}{c_2}{C}}{\termconv{\letpair{x}{y}{e_1}{c_1}}{\letpair{x}{y}{e_2}{c_2}}{C}}$

\end{center}

\end{frame}

\begin{frame}{Term conversion -- sum}

\begin{center}
  $\infrule{\typing[\Gamma][\noncomputable]{a}{A} \quad \typing[\Gamma][\noncomputable]{f}{\Fun[\One]{A}{C}} \quad \typing[\Gamma][\noncomputable]{g}{\Fun[\One]{B}{C}}}{\termconv{\case{\inl{a}}{f}{g}}{\app{f}{a}}{C}}$

  \vspace{2em}

  $\infrule{\typing[\Gamma][\noncomputable]{b}{B} \quad \typing[\Gamma][\noncomputable]{f}{\Fun[\One]{A}{C}} \quad \typing[\Gamma][\noncomputable]{g}{\Fun[\One]{B}{C}}}{\termconv{\case{\inr{b}}{f}{g}}{\app{g}{b}}{C}}$

  \vspace{2em}

  $\infrule{\termconv{a_1}{a_2}{A} \quad \type{B}}{\termconv{\inl{a_1}}{\inl{a_2}}{\Sum{A}{B}}}$ \quad
  $\infrule{\type{A} \quad \termconv{b_1}{b_2}{B}}{\termconv{\inr{b_1}}{\inr{b_2}}{\Sum{A}{B}}}$

  \vspace{2em}

  $\infrule{\termconv{e_1}{e_2}{\Sum{A}{B}} \quad \begin{array}{l} \termconv{f_1}{f_2}{\Fun[\One]{A}{C}} \\ \termconv{g_1}{g_2}{\Fun[\One]{B}{C}} \end{array}}{\termconv{\case{e_1}{f_1}{g_1}}{\case{e_2}{f_2}{g_2}}{C}}$
\end{center}

\end{frame}

\begin{frame}{Term conversion -- let}

\begin{center}
  $\infrule{\termconv[\Gamma]{a_1}{a_2}{A} \quad \termconv[\extend{\Gamma}{x}{A}]{b_1}{b_2}{B}}{\termconv[\Gamma]{\letin{x}{a_1}{b_1}}{\letin{x}{a_2}{b_2}}{B}}$
\end{center}

\end{frame}

\section{Totality}

\NewDocumentCommand{\emptyenv}{}{\emptyset}
\NewDocumentCommand{\extendenv}{m m m m}{#1, #2 : #3 := #4}
\NewDocumentCommand{\extendthm}{m m m m}{#1, #2 : #3 := #4}
\NewDocumentCommand{\extendpartial}{m m m m}{#1, \texttt{partial}\ #2 : #3 := #4}
\NewDocumentCommand{\totality}{m m m}{#1, \texttt{totality}\ #2\ #3}

\NewDocumentCommand{\env}{m}{#1\ \texttt{env}}

\begin{frame}{Environments}

Global environments: \\
$\Sigma ::=$ \\
\qquad $\emptyenv \pipe \extendthm{\Sigma}{h}{P}{p} \pipe \extendenv{\Sigma}{x}{A}{e} \pipe$ \\
\qquad $\extendpartial{\Sigma}{x}{A}{e} \pipe \totality{\Sigma}{x}{p}$

\end{frame}

\begin{frame}{Well-formed environments}

\begin{center}
  $\infrule{}{\env{\emptyenv}}$

  \vspace{2em}

  $\infrule{\env{\Sigma} \quad h \notin \Sigma \quad \proves[\Sigma \pipe \emptyctx]{p}{P}}{\env{\extendthm{\Sigma}{h}{P}{p}}}$

  \vspace{2em}

  $\infrule{\env{\Sigma} \quad x \notin \Sigma \quad \typing[\Sigma \pipe \emptyctx][\computable]{e}{A}}{\env{\extendenv{\Sigma}{x}{A}{e}}}$

  \vspace{2em}

  $\infrule{\env{\Sigma} \quad x \notin \Sigma \quad \typing[\Sigma \pipe \emptyctx][\computable]{e}{A} \quad e\ \textbf{fails syntactic check}}{\env{\extendpartial{\Sigma}{x}{A}{e}}}$

  \vspace{2em}

  $\infrule{\env{\Sigma} \quad \Sigma = \extendpartial{\Sigma_1}{x}{A}{e}, \Sigma_2 \quad \proves[\Sigma \pipe \emptyctx]{p}{\Ex{r}[A]{e =?= r}}}{\env{\totality{\Sigma}{x}{p}}}$
\end{center}

\end{frame}

\end{document}